(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{7532:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/create",function(){return r(6595)}])},1798:function(e,t,r){"use strict";r.d(t,{HE:function(){return addConnection},HZ:function(){return updateConnection},Qf:function(){return updateConnectionWithMessage},RU:function(){return getConnectionFrequency},Rd:function(){return deleteConnection},S7:function(){return fetchUserConnections},SY:function(){return formatRelativeTime},db:function(){return n.db},eA:function(){return fetchUserMessages}});var a=r(6100),n=r(4417);let getConnectionFrequency=e=>{if(!e.messageCount||0===e.messageCount)return"new";if(!e.lastMessageDate)return"recent";let t=new Date,r=e.lastMessageDate.toDate(),a=Math.floor((t.getTime()-r.getTime())/864e5);return a<=7?"frequent":a<=30?"recent":"new"},fetchUserConnections=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e)return console.log("No authenticated user found for fetching connections"),[];try{console.log("Fetching connections for user ID: ".concat(e.uid));let r=(0,a.hJ)(n.db,"users/".concat(e.uid,"/connections")),o=(0,a.IO)(r,(0,a.Xo)("updatedAt","desc"),(0,a.b9)(t));console.log("Executing Firestore query for connections");let i=await (0,a.PL)(o);console.log("Retrieved ".concat(i.docs.length," connections from Firestore"));let s=i.docs.map(e=>{let t=e.data();return console.log("Connection found - ID: ".concat(e.id,", Name: ").concat(t.name,", Relationship: ").concat(t.relationship)),{id:e.id,...t}});return s}catch(e){return console.error("Error fetching connections:",e),[]}},fetchUserMessages=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e)return console.log("No authenticated user found for fetching messages"),[];try{console.log("Fetching messages for user ID: ".concat(e.uid));let r=(0,a.hJ)(n.db,"users/".concat(e.uid,"/messages")),o=(0,a.IO)(r,(0,a.Xo)("createdAt","desc"),(0,a.b9)(t));console.log("Executing Firestore query for messages");let i=await (0,a.PL)(o);console.log("Retrieved ".concat(i.docs.length," messages from Firestore"));let s=i.docs.map(e=>{let t=e.data();return console.log("Message found - ID: ".concat(e.id,", Recipient: ").concat(t.recipientName)),{id:e.id,...t}});return s}catch(e){return console.error("Error fetching messages:",e),[]}},addConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{let r=(0,a.hJ)(n.db,"users/".concat(e.uid,"/connections")),o=a.EK.now(),i={...t,createdAt:o,updatedAt:o,messageCount:0},s=await (0,a.ET)(r,i);return{id:s.id,...i}}catch(e){throw console.error("Error adding connection:",e),e}},updateConnectionWithMessage=async(e,t)=>{if(e&&t)try{let r=(0,a.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t));await (0,a.r7)(r,{messageCount:(0,a.nP)(1),lastMessageDate:(0,a.Bt)(),updatedAt:(0,a.Bt)()}),console.log("Updated connection ".concat(t," with new message info."))}catch(e){console.error("Error updating connection ".concat(t," after message:"),e)}},updateConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{let r=(0,a.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t.id)),o={...t,updatedAt:a.EK.now()};delete o.id,await (0,a.r7)(r,o);let i=await (0,a.QT)(r);return{id:t.id,...i.data()}}catch(e){throw console.error("Error updating connection:",e),e}},formatRelativeTime=e=>{if(!e)return"Never";let t=new Date,r=e.toDate(),a=t.getTime()-r.getTime(),n=Math.floor(a/864e5),o=Math.floor(a%864e5/36e5),i=Math.floor(a%36e5/6e4);return n>30?"".concat(Math.floor(n/30)," ").concat(1===Math.floor(n/30)?"month":"months"," ago"):n>0?"".concat(n," ").concat(1===n?"day":"days"," ago"):o>0?"".concat(o," ").concat(1===o?"hour":"hours"," ago"):i>0?"".concat(i," ").concat(1===i?"minute":"minutes"," ago"):"Just now"},deleteConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{console.log("Deleting connection with ID: ".concat(t," for user: ").concat(e.uid));let r=(0,a.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t));return await (0,a.oe)(r),console.log("Successfully deleted connection with ID: ".concat(t)),!0}catch(e){throw console.error("Error deleting connection:",e),e}}},3278:function(e,t,r){"use strict";r.d(t,{B:function(){return useChallenges}});var a=r(7294),n=r(6100),o=r(4417);function useChallenges(){let[e,t]=(0,a.useState)([]),[r,i]=(0,a.useState)(!0),[s,l]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let fetchChallenges=async()=>{i(!0),l(null);try{console.log("[useChallenges] Fetching active challenge definitions...");let e=(0,n.hJ)(o.db,"challenges"),r=(0,n.IO)(e,(0,n.ar)("isActive","==",!0)),a=await (0,n.PL)(r),i=a.docs.map(e=>({id:e.id,...e.data()}));console.log("[useChallenges] Fetched ".concat(i.length," active challenges.")),t(i)}catch(e){console.error("[useChallenges] Error fetching challenges:",e),l(e)}finally{i(!1)}};fetchChallenges()},[]),{challenges:e,loading:r,error:s}}},8477:function(e,t,r){"use strict";r.d(t,{db:function(){return l},l2:function(){return s}});var a=r(3977),n=r(9451),o=r(6100),i=r(8887);let s=(0,a.C6)().length?(0,a.C6)()[0]:(0,a.ZF)({apiKey:"AIzaSyBZiJPTs7dMccVgFV-YoTejnhy1bZNFEQY",authDomain:"heartglowai.firebaseapp.com",projectId:"heartglowai",storageBucket:"heartglowai.firebasestorage.app",messagingSenderId:"196565711798",appId:"1:196565711798:web:79e2b0320fd8e74ab0df17",measurementId:"G-KJMPL1DNPY"});(0,n.v0)(s);let l=(0,o.ad)(s);(0,i.Gb)().then(e=>e?(0,i.IH)(s):null)},6595:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CreatePage}});var a=r(5893),n=r(7294),o=r(1163),i=r(8549),s=r(8477),l=r(6100),c=r(3495),d=r(1012),g=r(1664),u=r.n(g);function RecipientStep(e){let{onNext:t,initialData:r}=e;console.log(">>> RecipientStep component rendering started");let{currentUser:o}=(0,i.a)(),[g,m]=(0,n.useState)([]),[h,p]=(0,n.useState)(!0),[f,x]=(0,n.useState)(null),[y,b]=(0,n.useState)(null);(0,n.useEffect)(()=>{let fetchRecipients=async()=>{if(o)try{let e=(0,l.hJ)(s.db,"users",o.uid,"connections"),t=(0,l.IO)(e),a=await (0,l.PL)(t),n=a.docs.map(e=>({id:e.id,...e.data()}));if(m(n),null==r?void 0:r.id){let e=n.find(e=>e.id===r.id);e?x(e):(console.warn("Initial recipient ID not found in the current list."),x(null))}}catch(e){b("Failed to load recipients. Please try again."),console.error("Error fetching recipients:",e)}finally{p(!1)}};fetchRecipients()},[o,null==r?void 0:r.id]);let handleSelect=e=>{x(e)},formatLastContact=e=>{if(!e)return null;try{let t=e instanceof l.EK?e.toDate():new Date(e);if(isNaN(t.getTime()))return null;return t.toLocaleDateString()}catch(e){return console.error("Error formatting date:",e),null}};return h?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-heartglow-pink"})}):(0,a.jsxs)("div",{className:"space-y-8 dark:text-heartglow-offwhite",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Who would you like to message?"}),(0,a.jsx)(u(),{href:"/connections/add",legacyBehavior:!0,children:(0,a.jsxs)("a",{className:"inline-flex items-center px-4 py-2 border border-gray-600 text-sm font-medium rounded-md shadow-sm text-gray-300 bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink focus:ring-offset-gray-900 transition-colors",children:[(0,a.jsx)(d.Z,{size:16,className:"-ml-1 mr-2"}),"Add Connection"]})})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:"Select a recipient from your connections"}),y&&(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative dark:bg-red-900/30 dark:border-red-700/50 dark:text-red-300",role:"alert",children:y}),(0,a.jsx)("div",{className:"grid gap-4",children:0===g.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No recipients found."}),(0,a.jsx)(u(),{href:"/connections/add",legacyBehavior:!0,children:(0,a.jsxs)("a",{className:"inline-flex items-center px-4 py-2 border border-gray-600 text-sm font-medium rounded-md shadow-sm text-gray-300 bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink focus:ring-offset-gray-900 transition-colors",children:[(0,a.jsx)(d.Z,{size:16,className:"-ml-1 mr-2"}),"Add Your First Connection"]})})]}):g.map(e=>{let t=formatLastContact(e.lastContact);return(0,a.jsx)(c.E.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"p-4 rounded-lg border cursor-pointer transition-all duration-200 ".concat((null==f?void 0:f.id)===e.id?"border-transparent ring-2 ring-heartglow-pink bg-gradient-to-br from-heartglow-pink/10 via-white to-heartglow-violet/10 dark:from-heartglow-pink/40 dark:to-heartglow-violet/40":"bg-white border-gray-200 hover:border-heartglow-pink/80 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-heartglow-pink"),onClick:()=>handleSelect(e),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 dark:text-heartglow-offwhite",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.specificRelationship||e.relationship})]}),t&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Last contact: ",t]})]})},e.id)})}),(0,a.jsx)("div",{className:"flex justify-end mt-8",children:(0,a.jsx)("button",{onClick:()=>{if(f){let e={recipient:{id:f.id,name:f.name,relationship:f.relationship},connectionData:{specificRelationship:f.specificRelationship,yearsKnown:f.yearsKnown,communicationStyle:f.communicationStyle,relationshipGoal:f.relationshipGoal,lastMessageDate:f.lastContact instanceof l.EK?f.lastContact.toDate():f.lastContact}};t(e)}},disabled:!f,className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink ".concat(f?"bg-heartglow-pink hover:bg-heartglow-pink/90":"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-gray-700 dark:text-gray-400"),children:"Next"})})]})}let m=[{id:"check-in",title:"Check In",description:"A simple message to see how they're doing",icon:"\uD83D\uDC4B",color:"from-blue-400 to-blue-600"},{id:"gratitude",title:"Gratitude",description:"Express appreciation for their presence in your life",icon:"\uD83D\uDE4F",color:"from-heartglow-pink to-heartglow-violet"},{id:"support",title:"Support",description:"Offer help or encouragement during tough times",icon:"\uD83D\uDCAA",color:"from-green-400 to-teal-500"},{id:"celebration",title:"Celebration",description:"Share joy for their achievements or milestones",icon:"\uD83C\uDF89",color:"from-yellow-400 to-orange-500"},{id:"reconnection",title:"Reconnection",description:"Reach out after some time apart",icon:"\uD83E\uDD1D",color:"from-purple-400 to-indigo-500"},{id:"custom",title:"Custom",description:"Write your own message with a specific purpose",icon:"✍️",color:"from-gray-400 to-gray-600"}];function IntentStep(e){let{onNext:t,onBack:r,initialData:o}=e,[i,s]=(0,n.useState)((null==o?void 0:o.type)||null),[l,d]=(0,n.useState)((null==o?void 0:o.type)==="custom"&&o.custom||""),[g,u]=(0,n.useState)((null==o?void 0:o.type)==="custom");(0,n.useEffect)(()=>{if(o){s(o.type);let e="custom"===o.type;u(e),e&&d(o.custom||"")}else s(null),d(""),u(!1)},[o]);let handleSelect=e=>{s(e),u("custom"===e)};return(0,a.jsxs)("div",{className:"space-y-8 dark:text-heartglow-offwhite",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"What's the purpose of your message?"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Select the intent that best matches your goal"})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:m.map(e=>(0,a.jsx)(c.E.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"p-4 rounded-lg border cursor-pointer transition-all duration-200 ".concat(i===e.id?"border-transparent ring-2 ring-heartglow-pink bg-gradient-to-br from-heartglow-pink/10 via-white to-heartglow-violet/10 dark:from-heartglow-pink/40 dark:to-heartglow-violet/40":"bg-white border-gray-200 hover:border-heartglow-pink/80 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-heartglow-pink"),onClick:()=>handleSelect(e.id),children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-gradient-to-br ".concat(e.color," text-white text-2xl mr-3 shadow-sm"),children:e.icon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 dark:text-heartglow-offwhite",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]})]})},e.id))}),g&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-6",children:[(0,a.jsx)("label",{htmlFor:"custom-intent",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Describe your custom intent"}),(0,a.jsx)("textarea",{id:"custom-intent",value:l,onChange:e=>d(e.target.value),className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent resize-none  dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400",placeholder:"e.g., Invite to an event, ask for a favor...",rows:3,required:g})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,a.jsx)("button",{onClick:r,className:"inline-flex items-center justify-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md shadow-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-colors",children:"Back"}),(0,a.jsx)("button",{onClick:()=>{i&&t({intent:{type:i,custom:"custom"===i?l:void 0}})},disabled:!i||g&&!l.trim(),className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink ".concat(i&&(!g||l.trim())?"bg-heartglow-pink hover:bg-heartglow-pink/90":"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-gray-700 dark:text-gray-400"),children:"Next"})]})]})}var h=r(2560),p=r(7884),f=r(2546),x=r(3766),create_FormatStep=e=>{let{onNext:t,onBack:r,initialData:o}=e,[i,s]=(0,n.useState)((null==o?void 0:o.type)||""),[l,d]=(0,n.useState)((null==o?void 0:o.length)||"Standard (1 paragraph)"),[g,u]=(0,n.useState)((null==o?void 0:o.options)||{emailSubject:"",emojiPreference:"moderate",talkingPoints:3,platform:"general"});(0,n.useEffect)(()=>{o?(s(o.type||""),d(o.length||"Standard (1 paragraph)"),u(o.options||{emailSubject:"",emojiPreference:"moderate",talkingPoints:3,platform:"general"})):(s(""),d("Standard (1 paragraph)"),u({emailSubject:"",emojiPreference:"moderate",talkingPoints:3,platform:"general"}))},[o]);let m=[{id:"Very short (1-2 sentences)",label:"Very Short",description:"1-2 sentences",icon:(0,a.jsx)(h.Z,{size:20})},{id:"Short (approx. 1 paragraph)",label:"Short",description:"~1 paragraph",icon:(0,a.jsx)(p.Z,{size:20})},{id:"Medium (approx. 2 paragraphs)",label:"Medium",description:"~2 paragraphs",icon:(0,a.jsx)(f.Z,{size:20})},{id:"Long (3+ paragraphs)",label:"Long",description:"3+ paragraphs",icon:(0,a.jsx)(x.Z,{size:20})}];return(0,a.jsxs)("div",{className:"space-y-8 dark:text-heartglow-offwhite",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Choose Format & Length"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Select how your message will be delivered"})]}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-heartglow-offwhite mb-4",children:"Message Format"}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[{id:"text",label:"Text Message",icon:"\uD83D\uDCF1",description:"Simple message for direct delivery"},{id:"email",label:"Email",icon:"\uD83D\uDCE7",description:"Formal message with subject line"},{id:"conversation",label:"In-Person Conversation",icon:"\uD83D\uDCAC",description:"Talking points for face-to-face"},{id:"card",label:"Greeting Card",icon:"\uD83D\uDC8C",description:"Perfect for celebration or gratitude"},{id:"social",label:"Social Media",icon:"\uD83C\uDF10",description:"Public post or direct message"},{id:"letter",label:"Letter",icon:"✉️",description:"Traditional format for deep connection"}].map(e=>(0,a.jsxs)(c.E.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>s(e.id),className:"p-4 rounded-lg border cursor-pointer transition-all duration-200 ".concat(i===e.id?"border-transparent ring-2 ring-heartglow-pink bg-gradient-to-br from-heartglow-pink/10 via-white to-heartglow-violet/10 dark:from-heartglow-pink/40 dark:to-heartglow-violet/40":"bg-white border-gray-200 hover:border-heartglow-pink/80 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-heartglow-pink"),children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("span",{className:"text-2xl mr-2",children:e.icon}),(0,a.jsx)("span",{className:"font-medium text-gray-900 dark:text-heartglow-offwhite",children:e.label})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-heartglow-offwhite mb-4",children:"Message Length"}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:m.map(e=>(0,a.jsx)(c.E.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>d(e.id),className:"p-4 rounded-lg border cursor-pointer transition-all duration-200 flex flex-col items-center justify-between h-full ".concat(l===e.id?"border-transparent ring-2 ring-heartglow-pink bg-gradient-to-br from-heartglow-pink/10 via-white to-heartglow-violet/10 dark:from-heartglow-pink/40 dark:to-heartglow-violet/40":"bg-white border-gray-200 hover:border-heartglow-pink/80 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-heartglow-pink"),children:(0,a.jsxs)("div",{className:"flex flex-col items-center text-center flex-grow justify-center",children:[(0,a.jsx)("div",{className:"mb-3 text-heartglow-indigo dark:text-heartglow-pink",children:e.icon}),(0,a.jsx)("h4",{className:"font-medium text-gray-900 dark:text-heartglow-offwhite mb-1",children:e.label}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]})},e.id))})]}),i&&(()=>{switch(i){case"email":return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 dark:bg-heartglow-deepgray dark:border-gray-600",children:[(0,a.jsx)("label",{htmlFor:"email-subject",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Subject"}),(0,a.jsx)("input",{id:"email-subject",type:"text",value:g.emailSubject,onChange:e=>u(t=>({...t,emailSubject:e.target.value})),className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400",placeholder:"Enter email subject"})]});case"text":return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 dark:bg-heartglow-deepgray dark:border-gray-600",children:[(0,a.jsx)("label",{htmlFor:"emoji-usage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Emoji Usage"}),(0,a.jsxs)("select",{id:"emoji-usage",value:g.emojiPreference,onChange:e=>u(t=>({...t,emojiPreference:e.target.value})),className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600",children:[(0,a.jsx)("option",{value:"none",children:"No emojis"}),(0,a.jsx)("option",{value:"minimal",children:"Minimal emojis"}),(0,a.jsx)("option",{value:"moderate",children:"Moderate emojis"}),(0,a.jsx)("option",{value:"frequent",children:"Frequent emojis"})]})]});case"conversation":return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 dark:bg-heartglow-deepgray dark:border-gray-600",children:[(0,a.jsx)("label",{htmlFor:"talking-points",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Number of Talking Points"}),(0,a.jsx)("input",{id:"talking-points",type:"number",min:"1",max:"10",value:g.talkingPoints,onChange:e=>u(t=>({...t,talkingPoints:parseInt(e.target.value,10)||1})),className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400"})]});case"social":return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 dark:bg-heartglow-deepgray dark:border-gray-600",children:[(0,a.jsx)("label",{htmlFor:"platform",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Platform"}),(0,a.jsxs)("select",{id:"platform",value:g.platform,onChange:e=>u(t=>({...t,platform:e.target.value})),className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600",children:[(0,a.jsx)("option",{value:"general",children:"General"}),(0,a.jsx)("option",{value:"twitter",children:"Twitter"}),(0,a.jsx)("option",{value:"instagram",children:"Instagram"}),(0,a.jsx)("option",{value:"facebook",children:"Facebook"}),(0,a.jsx)("option",{value:"linkedin",children:"LinkedIn"})]})]});default:return null}})()]}),(0,a.jsxs)("div",{className:"flex justify-between mt-12",children:[(0,a.jsx)("button",{onClick:r,className:"inline-flex items-center justify-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md shadow-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-colors",children:"Back"}),(0,a.jsx)("button",{onClick:()=>{t({format:{type:i,length:l,options:g}})},disabled:!i||!l,className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink ".concat(i&&l?"bg-heartglow-pink hover:bg-heartglow-pink/90":"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-gray-700 dark:text-gray-400"),children:"Next"})]})]})};let y=[{id:"warm",label:"Warm",description:"Friendly and affectionate"},{id:"casual",label:"Casual",description:"Relaxed and informal"},{id:"sincere",label:"Sincere",description:"Honest and heartfelt"},{id:"playful",label:"Playful",description:"Light and fun"},{id:"formal",label:"Formal",description:"Professional and respectful"},{id:"reflective",label:"Reflective",description:"Thoughtful and introspective"},{id:"custom",label:"Custom",description:"Define your own tone"}];var create_ToneStep=e=>{let{onNext:t,onBack:r,initialData:o}=e,isStandardTone=e=>!!e&&y.some(t=>t.id===e&&"custom"!==t.id),i=!!o&&!isStandardTone(o),[s,l]=(0,n.useState)(i?"custom":o||null),[d,g]=(0,n.useState)(i&&o||""),[u,m]=(0,n.useState)(i);return(0,n.useEffect)(()=>{let e=!!o&&!isStandardTone(o);l(e?"custom":o||null),m(e),g(e&&o||"")},[o]),(0,a.jsxs)("div",{className:"space-y-8 dark:text-heartglow-offwhite",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"What tone would you like to use?"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Select the tone that best fits your message"})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:y.map(e=>(0,a.jsx)(c.E.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{l(e.id),m("custom"===e.id),"custom"!==e.id&&g("")},className:"p-4 rounded-lg border cursor-pointer transition-all duration-200 ".concat(s===e.id?"border-transparent ring-2 ring-heartglow-pink bg-gradient-to-br from-heartglow-pink/10 via-white to-heartglow-violet/10 dark:from-heartglow-pink/40 dark:to-heartglow-violet/40":"bg-white border-gray-200 hover:border-heartglow-pink/80 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-heartglow-pink"),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 dark:text-heartglow-offwhite",children:e.label}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]})},e.id))}),u&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-6",children:[(0,a.jsx)("label",{htmlFor:"custom-tone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Describe your desired tone"}),(0,a.jsx)("input",{id:"custom-tone",type:"text",value:d,onChange:e=>g(e.target.value),className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent  dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400",placeholder:"e.g., Encouraging, Empathetic...",required:u})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,a.jsx)("button",{onClick:r,className:"inline-flex items-center justify-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md shadow-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-colors",children:"Back"}),(0,a.jsx)("button",{onClick:()=>{let e="";s&&(e=u?d.trim():s),e&&t({tone:e})},disabled:!s||u&&!d.trim(),className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink ".concat(s&&(!u||d.trim())?"bg-heartglow-pink hover:bg-heartglow-pink/90":"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-gray-700 dark:text-gray-400"),children:"Next"})]})]})},b=r(6989);let LabelledSlider=e=>{let{label:t,value:r,onChange:n,min:o=1,max:i=5,helpText:s}=e,l=t.toLowerCase().includes("formality")?"formality":"depth";return(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[t,s&&(0,a.jsxs)("span",{className:"ml-2 group relative",children:[(0,a.jsx)(b.Z,{size:14,className:"text-gray-400 cursor-help"}),(0,a.jsx)("span",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 p-2 bg-gray-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 shadow-lg",children:s})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"range",min:o,max:i,value:r,onChange:e=>n(parseInt(e.target.value,10)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 slider-thumb"}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 w-28 text-right",children:"formality"===l?["Very Casual","Casual","Neutral","Formal","Very Formal"][r-1]||"Neutral":["Lighthearted","Warm","Personal","Deeply Personal","Vulnerable"][r-1]||"Personal"})]})]})};var create_ContextStyleStep=e=>{let{onNext:t,onBack:r,initialData:o}=e,[i,s]=(0,n.useState)((null==o?void 0:o.promptedBy)||""),[l,d]=(0,n.useState)((null==o?void 0:o.messageGoal)||""),[g,u]=(0,n.useState)((null==o?void 0:o.formalityLevel)||3),[m,h]=(0,n.useState)((null==o?void 0:o.emotionalDepth)||3),[p,f]=(0,n.useState)((null==o?void 0:o.customInstructionsText)||""),[x,y]=(0,n.useState)((null==o?void 0:o.customInstructionsOptions)||{mentionMemory:!1,askQuestion:!1});(0,n.useEffect)(()=>{s((null==o?void 0:o.promptedBy)||""),d((null==o?void 0:o.messageGoal)||""),u((null==o?void 0:o.formalityLevel)||3),h((null==o?void 0:o.emotionalDepth)||3),f((null==o?void 0:o.customInstructionsText)||""),y((null==o?void 0:o.customInstructionsOptions)||{mentionMemory:!1,askQuestion:!1})},[o]);let handleCheckboxChange=e=>{y(t=>({...t,[e]:!t[e]}))};return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-8 dark:text-heartglow-offwhite",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Context & Style"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Add details to personalize the message further."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"promptedBy",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"What prompted this message? (Optional)"}),(0,a.jsx)("input",{id:"promptedBy",type:"text",value:i,onChange:e=>s(e.target.value),placeholder:"e.g., Saw their post, thinking of them, upcoming birthday...",className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"messageGoal",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Main goal for this message? (Optional)"}),(0,a.jsx)("input",{id:"messageGoal",type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"e.g., Make them feel appreciated, get them to reply...",className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)(LabelledSlider,{label:"Formality",value:g,onChange:u,helpText:"How formal or casual should the language be?"}),(0,a.jsx)(LabelledSlider,{label:"Emotional Depth",value:m,onChange:h,helpText:"How personal or lighthearted should the message feel?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Specific Guidance (Optional)"}),(0,a.jsxs)("div",{className:"space-y-2 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"mentionMemory",type:"checkbox",checked:x.mentionMemory,onChange:()=>handleCheckboxChange("mentionMemory"),className:"h-4 w-4 text-heartglow-pink border-gray-300 rounded focus:ring-heartglow-pink dark:bg-gray-700 dark:border-gray-600"}),(0,a.jsx)("label",{htmlFor:"mentionMemory",className:"ml-2 block text-sm text-gray-900 dark:text-gray-300",children:"Mention a specific memory/event"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"askQuestion",type:"checkbox",checked:x.askQuestion,onChange:()=>handleCheckboxChange("askQuestion"),className:"h-4 w-4 text-heartglow-pink border-gray-300 rounded focus:ring-heartglow-pink dark:bg-gray-700 dark:border-gray-600"}),(0,a.jsx)("label",{htmlFor:"askQuestion",className:"ml-2 block text-sm text-gray-900 dark:text-gray-300",children:"Include a question for them"})]})]}),(0,a.jsx)("textarea",{value:p,onChange:e=>f(e.target.value),rows:3,className:"w-full p-3 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent dark:bg-heartglow-deepgray dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400 resize-none",placeholder:"Any other specific instructions for the AI? (e.g., 'Avoid talking about work', 'Keep it optimistic')"})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-12",children:[(0,a.jsx)("button",{onClick:r,className:"inline-flex items-center justify-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md shadow-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-colors",children:"Back"}),(0,a.jsx)("button",{onClick:()=>{t({promptedBy:i,messageGoal:l,formalityLevel:g,emotionalDepth:m,customInstructionsText:p,customInstructionsOptions:x})},className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-heartglow-pink hover:bg-heartglow-pink/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink transition-colors",children:"Generate Message"})]})]})},w=r(7004);async function generateMessage(e){try{console.log("[messageGenerator] Calling generateEnhancedMessage with params:",e);let t=(0,w.$C)(s.l2),r=(0,w.V1)(t,"generateEnhancedMessage"),a=await r({params:e}),n=a.data;if(n&&n.content)return console.log("[messageGenerator] Received response:",n),{content:n.content,insights:n.insights||[]};throw console.error("[messageGenerator] Cloud function returned invalid data structure:",n),Error("Invalid response structure from generation function")}catch(e){return console.error("[messageGenerator] Error calling generateEnhancedMessage function:",e),{content:"Sorry, we couldn't generate a message right now. ".concat(e.message||"Please try again later."," "),insights:[]}}}var v=r(1798),k=r(116),j=r(3742),N=r(6915),C=r(4464),S=r(9560),D=r(3219),E=r(9589),M=r(3278);function MessageOutput(e){let{recipient:t,connectionData:r,intent:d,format:g,tone:m,promptedBy:h,messageGoal:p,formalityLevel:f,emotionalDepth:x,customInstructionsText:y,customInstructionsOptions:b}=e,[w,I]=(0,n.useState)(!0),[T,F]=(0,n.useState)(!1),[P,B]=(0,n.useState)(""),[A,L]=(0,n.useState)([]),[R,G]=(0,n.useState)(null),{currentUser:O,userProfile:z}=(0,i.a)(),{challenges:Z}=(0,M.B)(),[_,J]=(0,n.useState)(!0),U=(0,o.useRouter)(),[q,H]=(0,n.useState)(!1),[Q,K]=(0,n.useState)(!1),[W,V]=(0,n.useState)(""),[Y,X]=(0,n.useState)([]),$=null==z?void 0:z.activeChallenge;$&&Z.find(e=>e.id===$.challengeId);let autoSaveMessage=async(e,r)=>{if(!O||!t){console.warn("[autoSaveMessage] No user or recipient, cannot save message.");return}if(!e){console.warn("[autoSaveMessage] No message content generated, cannot save.");return}console.log("[autoSaveMessage] Attempting to save message for user:",O.uid);try{let a={content:e,recipientName:t.name,recipientId:t.id||null,relationship:t.relationship,intent:(null==d?void 0:d.type)||"unknown",tone:m||"neutral",formality:null!=f?f:3,depth:null!=x?x:3,promptContext:h||null,goalContext:p||null,createdAt:(0,l.Bt)(),insights:r,messageCategory:(null==d?void 0:d.type)||"unknown",messageFormat:(null==g?void 0:g.type)||"unknown",messageLength:(null==g?void 0:g.length)||"unknown",messageConfigTimestamp:new Date().toISOString(),appliedToChallenge:!!$&&_};console.log("[autoSaveMessage] Saving data:",a);let n=(0,l.hJ)(s.db,"users",O.uid,"messages"),o=await (0,l.ET)(n,a);console.log("[autoSaveMessage] Message auto-saved successfully with ID:",o.id);let i=(0,l.JU)(s.db,"users",O.uid);await (0,l.r7)(i,{totalMessageCount:(0,l.nP)(1)}),console.log("[autoSaveMessage] Incremented user totalMessageCount."),t.id?await (0,v.Qf)(O,t.id):console.warn("[autoSaveMessage] No recipient.id found, cannot update connection message count.")}catch(e){console.error("[autoSaveMessage] Error auto-saving message or updating counts:",e)}};(0,n.useEffect)(()=>{let generateAndSave=async()=>{let e="",a=[];if(!t||!d||!g||!m){G("Missing required information to generate message."),I(!1);return}try{let n;I(!0),G(null);let o={recipient:{name:t.name,relationship:t.relationship,id:t.id},connectionData:r||{},intent:d,format:g,tone:m,promptedBy:h||"",messageGoal:p||"",style:{formality:f||3,depth:x||3,length:g.length},customInstructions:{text:y||"",options:b||{}}};try{console.log("[generateAndSave] Calling generateMessage cloud function with params:",o),n=await generateMessage(o),console.log("[generateAndSave] Cloud function result:",n)}catch(e){throw console.warn("[generateAndSave] Cloud function failed, falling back:",e),e}if(n&&n.content)e=n.content,a=n.insights||[],B(e),L(a);else throw Error("Invalid response from generation function")}catch(e){console.error("Error generating message:",e),G("Failed to generate message. Please try again.")}finally{I(!1)}};generateAndSave()},[t,r,d,g,m,h,p,f,x,y,b]);let handleConfirmSave=async()=>{if(!P||!t){console.error("No message content or recipient to save.");return}if(console.log("handleConfirmSave triggered. applyToChallenge state:",_),await autoSaveMessage(P,A),_&&$){var e,r,a,n;let t=Z.find(e=>e.id===$.challengeId),o=null!==(a=null!==(r=null==t?void 0:null===(e=t.criteria)||void 0===e?void 0:e.value)&&void 0!==r?r:$.goal)&&void 0!==a?a:1,i=null!==(n=$.progress)&&void 0!==n?n:0;console.log("[handleConfirmSave] Checking challenge completion: Progress=".concat(i,", Goal=").concat(o)),i+1>=Number(o)?(console.log("[handleConfirmSave] Challenge appears completed. Setting sessionStorage flag..."),sessionStorage.setItem("challengeCompleted","true"),console.log("[handleConfirmSave] sessionStorage flag set.")):console.log("[handleConfirmSave] Challenge not yet completed by this message.")}handleCopyToClipboard(P),U.push("/")},handleCopyToClipboard=e=>{navigator.clipboard.writeText(e).then(()=>{F(!0),setTimeout(()=>F(!1),2e3)}).catch(e=>{console.error("Failed to copy:",e)})},generateInsightsAndGrade=async()=>{if(P&&t&&d&&m){K(!0);try{let e=await (null==O?void 0:O.getIdToken()),r=await fetch("https://us-central1-heartglowai.cloudfunctions.net/generateMessageInsights",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({message:P,recipient:{name:t.name,relationship:t.relationship},intent:d.type,tone:m})}),a=await r.json();if(a&&a.grade&&a.insights)V(a.grade),X(a.insights),H(!0);else throw Error("Invalid response from insights generation")}catch(e){console.error("Error generating insights:",e),V("A-"),X(["This message has a warm, personal tone that's perfect for your ".concat(null==t?void 0:t.relationship,"."),"The content is specific and thoughtful, showing genuine interest in reconnection.","By mentioning specific details, you create an authentic connection point."]),H(!0)}finally{K(!1)}}};if(w)return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center py-20 max-w-md mx-auto",children:[(0,a.jsx)(c.E.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 mb-6 rounded-full border-4 border-gray-600 border-t-heartglow-pink"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-300 mb-2",children:"Crafting your heartfelt message..."}),(0,a.jsx)("p",{className:"text-gray-400",children:"This may take just a moment."})]});if(R)return(0,a.jsxs)("div",{className:"text-center py-12 max-w-md mx-auto bg-gray-800/50 border border-red-500/30 rounded-xl p-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-900/30 text-red-400 rounded-full flex items-center justify-center mx-auto mb-5",children:(0,a.jsx)(k.Z,{size:32})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-red-400 mb-3",children:R}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 inline-flex items-center justify-center bg-gray-600 hover:bg-gray-500 text-gray-100 font-medium rounded-lg px-6 py-2.5 transition-colors",children:"Try Again"})]});let ee=(null==t?void 0:t.name)||"them";return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"max-w-3xl mx-auto py-8 md:py-12 space-y-8",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(c.E.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-3xl md:text-4xl font-bold bg-gradient-to-r from-heartglow-pink to-heartglow-violet text-transparent bg-clip-text mb-2",children:"Your Message Is Ready"}),(0,a.jsxs)(c.E.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-2 text-lg text-gray-400",children:["Crafted for ",ee," with ",(null==g?void 0:g.type)==="email"?"an email":"a message"," that conveys ",(null==d?void 0:d.type)||"your intention"]})]}),(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-br from-gray-800 to-gray-900 p-6 md:p-8 rounded-xl shadow-lg border border-gray-700/80",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-5",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-white",children:["Message for ",ee]}),(0,a.jsxs)("button",{onClick:()=>handleCopyToClipboard(P),className:"text-sm px-3 py-1.5 rounded-full transition-all duration-200 flex items-center focus:outline-none focus:ring-2 focus:ring-heartglow-pink focus:ring-offset-2 focus:ring-offset-gray-900 ".concat(T?"bg-green-600/80 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"),"aria-label":T?"Copied!":"Copy message",children:[T?(0,a.jsx)(j.Z,{size:16,className:"mr-1.5"}):(0,a.jsx)(N.Z,{size:16,className:"mr-1.5"}),T?"Copied!":"Copy"]})]}),(0,a.jsx)("div",{className:"bg-gray-900/50 p-5 rounded-lg border border-gray-700 min-h-[150px]",children:(0,a.jsx)("p",{className:"whitespace-pre-wrap text-gray-200 text-base md:text-lg leading-relaxed",children:P})})]}),(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Message Analysis"}),!q&&(0,a.jsx)("button",{onClick:generateInsightsAndGrade,disabled:Q,className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium transition-all ".concat(Q?"bg-gray-600 cursor-wait":"bg-heartglow-pink hover:bg-heartglow-pink/90"," text-white"),children:Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 mr-2 rounded-full border-2 border-white border-t-transparent animate-spin"}),"Analyzing..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Z,{size:16,className:"mr-1.5"}),"Reveal Analysis"]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl border border-gray-700/60 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-700/60 flex justify-between items-center",children:(0,a.jsxs)("h4",{className:"font-medium text-white flex items-center",children:[(0,a.jsx)(S.Z,{size:16,className:"mr-1.5 text-yellow-400"}),"Message Grade"]})}),(0,a.jsx)("div",{className:"p-6 h-32 flex items-center justify-center ".concat(q?"":"blur-lg select-none"," transition-all duration-300"),children:q?(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("span",{className:"text-5xl font-bold bg-gradient-to-r from-yellow-400 to-heartglow-pink text-transparent bg-clip-text",children:W})}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-700/30 animate-pulse rounded-md"})})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl border border-gray-700/60 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-700/60",children:(0,a.jsx)("h4",{className:"font-medium text-white",children:"Detailed Insights"})}),(0,a.jsx)("div",{className:"p-6 h-32 overflow-y-auto ".concat(q?"":"blur-lg select-none"," transition-all duration-300"),children:q?(0,a.jsx)("ul",{className:"space-y-2 text-sm text-gray-300",children:Y.map((e,t)=>(0,a.jsxs)("li",{className:"flex",children:[(0,a.jsx)("span",{className:"text-heartglow-pink mr-2",children:"•"}),(0,a.jsx)("span",{children:e})]},t))}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"w-full h-4 bg-gray-700/30 animate-pulse rounded-md"}),(0,a.jsx)("div",{className:"w-full h-4 bg-gray-700/30 animate-pulse rounded-md"}),(0,a.jsx)("div",{className:"w-3/4 h-4 bg-gray-700/30 animate-pulse rounded-md"})]})})]})]})]}),(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"flex justify-center gap-4 mt-8",children:[(0,a.jsx)(u(),{href:"/",children:(0,a.jsxs)("button",{className:"inline-flex items-center justify-center px-8 py-3 border border-gray-600 text-base font-medium rounded-full shadow-sm text-white bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-gray-900 transition-all duration-150 ease-in-out",children:[(0,a.jsx)(D.Z,{size:20,className:"mr-2"}),"Return to Dashboard"]})}),(0,a.jsxs)("button",{onClick:handleConfirmSave,className:"inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-full shadow-sm text-white bg-gradient-to-r from-heartglow-pink to-heartglow-violet hover:from-heartglow-pink/90 hover:to-heartglow-violet/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink focus:ring-offset-gray-900 transition-all duration-150 ease-in-out transform hover:scale-105",children:[(0,a.jsx)(E.Z,{size:20,className:"mr-2"}),"Done - Save & Copy Message"]})]})]})}var I=r(1526);let T=[{number:1,label:"Recipient"},{number:2,label:"Intent"},{number:3,label:"Format"},{number:4,label:"Tone"},{number:5,label:"Context & Style"}];function CreatePage(){console.log(">>> CreatePage component rendering started");let e=(0,o.useRouter)(),{currentUser:t,loading:r}=(0,i.a)(),[s,l]=(0,n.useState)(1),[d,g]=(0,n.useState)({recipient:null,connectionData:null,intent:null,format:null,tone:null,promptedBy:"",messageGoal:"",formalityLevel:3,emotionalDepth:3,customInstructionsText:"",customInstructionsOptions:{}});if((0,n.useEffect)(()=>{if(e.isReady){let{intent:t,tone:r}=e.query;(t||r)&&(console.log(">>> Query params found:",{queryIntent:t,queryTone:r}),g(e=>({...e,intent:t?{type:t,custom:""}:e.intent,tone:r||e.tone})))}},[e.isReady,e.query]),r)return(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-heartglow-pink"})});if(!t)return e.push("/login"),null;let handleNext=e=>{g(t=>({...t,...e})),l(e=>e+1)},handleBack=()=>{l(e=>e-1)};return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-heartglow-deepgray dark:to-gray-900 py-16 md:py-24",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"bg-white dark:bg-heartglow-deepgray text-gray-900 dark:text-gray-100 rounded-xl shadow-xl overflow-hidden p-8 sm:p-10",children:[s<=5&&(0,a.jsx)("div",{className:"mb-10 sm:mb-12",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:T.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center flex-grow justify-center flex-col sm:flex-row",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg mb-1 transition-all duration-300 ".concat(e.number<s?"bg-heartglow-pink text-white shadow-md":e.number===s?"bg-heartglow-violet text-white scale-110 shadow-lg":"bg-gray-200 dark:bg-gray-600 text-gray-500 dark:text-gray-400"),children:e.number}),(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium transition-colors duration-300 ".concat(e.number<=s?"text-heartglow-charcoal dark:text-heartglow-offwhite":"text-gray-400 dark:text-gray-500"),children:e.label})]}),t<T.length-1&&(0,a.jsx)("div",{className:"h-1 flex-grow mx-2 mt-5 hidden sm:block transition-colors duration-300 ".concat(e.number<s?"bg-heartglow-pink":"bg-gray-200 dark:bg-gray-600")})]},e.number))})}),(console.log(">>> CreatePage rendering step: ".concat(s)),(0,a.jsx)(I.M,{mode:"wait",children:(0,a.jsx)(c.E.div,{variants:{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50}},initial:"initial",animate:"animate",exit:"exit",transition:{duration:.3,ease:"easeInOut"},children:(()=>{switch(s){case 1:return(0,a.jsx)(RecipientStep,{onNext:handleNext,initialData:d.recipient});case 2:return(0,a.jsx)(IntentStep,{onNext:handleNext,onBack:handleBack,initialData:d.intent});case 3:var e,t,r;return(0,a.jsx)(create_FormatStep,{onNext:handleNext,onBack:handleBack,initialData:{type:null===(e=d.format)||void 0===e?void 0:e.type,length:null===(t=d.format)||void 0===t?void 0:t.length,options:null===(r=d.format)||void 0===r?void 0:r.options}});case 4:return(0,a.jsx)(create_ToneStep,{onNext:handleNext,onBack:handleBack,initialData:d.tone});case 5:return(0,a.jsx)(create_ContextStyleStep,{onNext:handleNext,onBack:handleBack,initialData:{promptedBy:d.promptedBy,messageGoal:d.messageGoal,formalityLevel:d.formalityLevel,emotionalDepth:d.emotionalDepth,customInstructionsText:d.customInstructionsText,customInstructionsOptions:d.customInstructionsOptions}});case 6:return(0,a.jsx)(MessageOutput,{recipient:d.recipient,connectionData:d.connectionData,intent:d.intent,format:d.format,tone:d.tone,promptedBy:d.promptedBy,messageGoal:d.messageGoal,formalityLevel:d.formalityLevel,emotionalDepth:d.emotionalDepth,customInstructionsText:d.customInstructionsText,customInstructionsOptions:d.customInstructionsOptions});default:return null}})()},s)}))]})})})}}},function(e){e.O(0,[424,495,887,4,39,774,888,179],function(){return e(e.s=7532)}),_N_E=e.O()}]);