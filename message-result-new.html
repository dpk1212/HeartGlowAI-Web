<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartGlowAI - Your Message</title>
    <meta name="description" content="View and share your personalized heartfelt message created with HeartGlowAI">
    
    <!-- Preconnect to Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload key assets -->
    <link rel="preload" href="css/main.css" as="style">
    <link rel="preload" href="js/message-result-new.js" as="script">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    
    <!-- Firebase Config -->
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBZiJPTs7dMccVgFV-YoTejnhy1bZNFEQY",
            authDomain: "heartglowai.firebaseapp.com",
            projectId: "heartglowai",
            storageBucket: "heartglowai.firebasestorage.app",
            messagingSenderId: "196565711798",
            appId: "1:196565711798:web:79e2b0320fd8e74ab0df17",
            measurementId: "G-KJMPL1DNPY"
        };
        
        // Initialize Firebase if not already initialized
        if (!window.firebase || !firebase.apps || !firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } else {
            console.log("Firebase already initialized");
        }
        
        // Critical: Set persistence to LOCAL
        if (firebase && firebase.auth) {
            firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)
                .catch(function(error) {
                    console.error("Auth persistence error:", error);
                });
        }
    </script>
    
    <!-- FontAwesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" integrity="sha512-fD9DI5bZwQxOi7MhYWnnNPlvXdp/2Pj3XSTRrFs5FQa4mizyGLnJcN6tuvUS6LbmgN1ut+XGSABKvjN0H6Aoow==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
    <style>
        /* Additional inline styles for better UI */
        .message-card--premium {
            background: linear-gradient(145deg, #ffffff 0%, #f7f5ff 100%);
            border-radius: 24px;
            box-shadow: 0 15px 40px rgba(138, 87, 222, 0.25);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
            transform: translateZ(0);
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            animation: floatCard 6s ease-in-out infinite;
        }
        
        .message-card__content--premium {
            padding: 3rem;
            position: relative;
            background: linear-gradient(135deg, #ffffff 0%, #f9f7ff 100%);
            border-radius: 18px;
            box-shadow: inset 0 1px 3px rgba(255, 255, 255, 0.9), 0 5px 15px rgba(138, 87, 222, 0.1);
            overflow: hidden;
        }
        
        .message-card__premium-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(138, 87, 222, 0.08) 0%, rgba(255, 255, 255, 0) 100%);
            z-index: -1;
            opacity: 0.8;
        }
        
        .message-card__text {
            font-size: 1.2rem;
            line-height: 1.8;
            white-space: pre-wrap;
            color: #333;
            position: relative;
            padding: 0.5rem 0;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
            letter-spacing: 0.01em;
        }
        
        .message-card__text::selection {
            background: rgba(138, 87, 222, 0.2);
        }
        
        .message-card__loading-heart {
            transform: scale(1.5);
            margin-bottom: 2rem;
        }
        
        .drop-cap {
            font-size: 3.5em !important;
            font-weight: 600 !important;
            color: #8a57de !important;
            float: left !important;
            line-height: 0.8 !important;
            margin-right: 0.15em !important;
            margin-top: 0.1em !important;
            text-shadow: 1px 1px 2px rgba(138, 87, 222, 0.3) !important;
        }
        
        .premium-background {
            background: linear-gradient(135deg, #0c0a30 0%, #1e1c3b 100%);
            min-height: 100vh;
            overflow-y: auto;
            padding-bottom: 5rem;
        }
        
        .message-insights {
            margin-top: 2rem;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 16px;
            padding: 1.8rem;
            border-left: 4px solid #8a57de;
            box-shadow: 0 10px 25px rgba(138, 87, 222, 0.12);
            animation: fadeInUp 0.8s ease-out forwards;
            position: relative;
            overflow: hidden;
        }
        
        .message-insights::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at bottom right, rgba(138, 87, 222, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
            border-radius: 50%;
        }
        
        .message-insights__title {
            color: #8a57de;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            margin-bottom: 1.2rem;
            font-weight: 600;
        }
        
        .insight-item {
            padding: 1rem 0;
            border-bottom: 1px solid rgba(138, 87, 222, 0.1);
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
            position: relative;
            padding-left: 1.2rem;
        }
        
        .insight-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8a57de 0%, #5091F5 100%);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .page-navigation {
            display: flex;
            justify-content: space-between;
            margin: 1.5rem 0;
            max-width: 800px;
            margin: 2rem auto;
        }
        
        /* Fix button styles */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .primary-button, .secondary-button {
            padding: 0.8rem 1.8rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .primary-button {
            background: #8a57de;
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(138, 87, 222, 0.25);
        }
        
        .secondary-button {
            background: rgba(138, 87, 222, 0.08);
            color: #8a57de;
            border: 1px solid rgba(138, 87, 222, 0.3);
        }
        
        .primary-button:hover {
            background: #7645c5;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(138, 87, 222, 0.35);
        }
        
        .secondary-button:hover {
            background: rgba(138, 87, 222, 0.12);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(138, 87, 222, 0.1);
        }
        
        .message-card__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.2rem;
            border-bottom: 1px solid rgba(138, 87, 222, 0.15);
            position: relative;
            z-index: 1;
        }
        
        .message-card__badge {
            display: flex;
            align-items: center;
            color: #8a57de;
            font-size: 0.9rem;
            font-weight: 600;
            background: rgba(138, 87, 222, 0.08);
            padding: 0.6rem 1rem;
            border-radius: 30px;
            border: 1px solid rgba(138, 87, 222, 0.15);
            box-shadow: 0 2px 5px rgba(138, 87, 222, 0.1);
            animation: pulse-badge 3s infinite alternate ease-in-out;
        }
        
        @keyframes pulse-badge {
            0% { box-shadow: 0 2px 5px rgba(138, 87, 222, 0.1); }
            100% { box-shadow: 0 4px 12px rgba(138, 87, 222, 0.25); }
        }
        
        .message-card__actions {
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            margin-top: 2.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(138, 87, 222, 0.1);
        }
        
        .message-card__action {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            background: transparent;
            border: none;
            color: #666;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .message-card__action:hover {
            background: rgba(138, 87, 222, 0.08);
            color: #8a57de;
            transform: translateY(-2px);
        }
        
        .message-card__action:hover .message-card__action-icon {
            transform: scale(1.2);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .message-card__action-icon {
            font-size: 1.2rem;
            margin-bottom: 0.3rem;
            color: #8a57de;
        }

        #app {
            height: auto;
            min-height: 100vh;
            overflow-y: auto;
        }
        
        .main-content {
            padding-bottom: 4rem;
        }

        /* Container with animation effect for the message */
        .message-container {
            position: relative;
            overflow: hidden;
            border-radius: 18px;
            background: #fff;
            padding: 2rem;
            margin: 2rem auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            max-width: 750px;
        }

        .message-container::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(135deg, #8a57de 0%, #5091F5 100%);
            z-index: -1;
            filter: blur(20px);
            opacity: 0.15;
            animation: pulse 3s infinite alternate;
        }

        @keyframes pulse {
            0% { opacity: 0.1; transform: scale(0.98); }
            100% { opacity: 0.2; transform: scale(1); }
        }

        /* Make page scrollable with fixed header */
        body {
            overflow-y: auto;
        }

        .app-header {
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        /* More vibrant elements */
        .recipient-card {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 1.5rem auto;
            backdrop-filter: blur(10px);
        }

        .recipient-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7645c5 0%, #5091F5 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            box-shadow: 0 4px 15px rgba(138, 87, 222, 0.4);
        }

        .recipient-info {
            flex: 1;
        }

        .recipient-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.3rem;
        }

        .recipient-relation {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .message-details {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            max-width: 800px;
            margin: 0 auto 2rem;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.6rem 1.2rem;
            border-radius: 30px;
            backdrop-filter: blur(5px);
        }

        .detail-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .detail-value {
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }

        /* Update page header */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            max-width: 800px;
            margin: 2rem auto;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #8a57de 0%, #5091F5 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .page-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Enhanced animations and effects */
        @keyframes floatCard {
            0% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0); }
        }
        
        .message-card__content--premium::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            transform: rotate(25deg);
            animation: shimmer 8s infinite linear;
            z-index: 0;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-200%) rotate(25deg); }
            100% { transform: translateX(200%) rotate(25deg); }
        }
        
        .message-card__body {
            position: relative;
            z-index: 1;
        }
        
        .message-card__badge {
            animation: pulse-badge 3s infinite alternate ease-in-out;
        }
        
        @keyframes pulse-badge {
            0% { box-shadow: 0 2px 5px rgba(138, 87, 222, 0.1); }
            100% { box-shadow: 0 4px 12px rgba(138, 87, 222, 0.25); }
        }
        
        .message-card__action:hover .message-card__action-icon {
            transform: scale(1.2);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .message-insights {
            animation: fadeInUp 0.8s ease-out forwards;
            position: relative;
            overflow: hidden;
        }
        
        @keyframes fadeInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .insight-item {
            position: relative;
            padding-left: 1.2rem;
        }
        
        .insight-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8a57de 0%, #5091F5 100%);
        }
        
        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: toastIn 0.3s ease forwards;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toast--success {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            color: white;
        }
        
        .toast--error {
            background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
            color: white;
        }
        
        @keyframes toastIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Share modal enhancements */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 38, 0.85);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #777;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #333;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .share-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .share-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            border-radius: 12px;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .share-option:hover {
            background: #e9e9f9;
            transform: translateY(-2px);
        }
        
        .share-option i {
            font-size: 1.5rem;
            color: #8a57de;
        }
        
        .share-link-container {
            display: flex;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .share-link {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            font-size: 0.9rem;
            color: #333;
        }
        
        .copy-button {
            padding: 0.75rem 1rem;
            background: #f5f5f5;
            border: none;
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .copy-button:hover {
            background: #e9e9f9;
        }
        
        .share-success {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            margin-top: 1rem;
            border-radius: 8px;
            background: #e6f7e6;
            color: #2e7d32;
        }
    </style>
</head>
<body class="message-result-page premium-background">
    <div id="app">
        <!-- App Header -->
        <header class="app-header">
            <div class="brand-logo">
                <div class="logo-heart"></div>
                <div class="brand-name">Heart<span class="brand-ai">GlowAI</span></div>
            </div>
            
            <div class="user-menu">
                <div class="user-profile">
                    <button id="userMenuBtn" class="user-avatar">
                        <img id="userAvatar" src="images/default-avatar.png" alt="Profile">
                    </button>
                    <div id="userDropdown" class="dropdown-menu">
                        <div class="dropdown-header">
                            <div id="userDisplayName" class="dropdown-name">User</div>
                            <div id="userEmail" class="dropdown-email">user@example.com</div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="home.html" class="dropdown-item">
                            <i class="fas fa-home"></i>
                            Dashboard
                        </a>
                        <a href="settings.html" class="dropdown-item">
                            <i class="fas fa-cog"></i>
                            Settings
                        </a>
                        <button id="logoutBtn" class="dropdown-item">
                            <i class="fas fa-sign-out-alt"></i>
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Progress Steps -->
            <div class="progress-container">
                <div class="progress-steps">
                    <div class="progress-step completed">
                        <div class="step-number"><i class="fas fa-check"></i></div>
                        <div class="step-label">Intention</div>
                    </div>
                    <div class="progress-step completed">
                        <div class="step-number"><i class="fas fa-check"></i></div>
                        <div class="step-label">Recipient</div>
                    </div>
                    <div class="progress-step completed">
                        <div class="step-number"><i class="fas fa-check"></i></div>
                        <div class="step-label">Tone</div>
                    </div>
                    <div class="progress-step active">
                        <div class="step-number">4</div>
                        <div class="step-label">Message</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-indicator" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="page-header">
                <h1 class="page-title">Your Message</h1>
                <p class="page-description">Here's your personalized message. You can edit it, regenerate or share it.</p>
            </div>
            
            <!-- Navigation Buttons (Adding these to fix the console errors) -->
            <div class="page-navigation">
                <button id="backBtn" class="secondary-button">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button id="dashboardBtn" class="primary-button">
                    <i class="fas fa-home"></i> Dashboard
                </button>
            </div>
            
            <!-- Message Information -->
            <div class="recipient-card">
                <div class="recipient-avatar" id="recipientAvatar">
                    <span id="recipientInitial">?</span>
                </div>
                <div class="recipient-info">
                    <h3 class="recipient-name" id="recipientName">Loading recipient...</h3>
                    <div class="recipient-relation" id="recipientRelation">Preparing...</div>
                </div>
            </div>
            
            <div class="message-details">
                <div class="detail-item">
                    <div class="detail-label">Intention:</div>
                    <div class="detail-value" id="intentDisplay">Loading...</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Tone:</div>
                    <div class="detail-value" id="toneDisplay">Loading...</div>
                </div>
            </div>
            
            <!-- Message Display -->
            <div id="messageState" class="message-card message-card--premium">
                <div class="message-card__premium-background"></div>
                
                <div id="loadingState" class="message-card__loading">
                    <div class="message-card__loading-heart">
                        <div class="message-card__loading-heart-shape"></div>
                        <div class="message-card__loading-heart-glow"></div>
                    </div>
                    <p class="message-card__loading-text">Creating your message with heart<span class="message-card__loading-dots"><span></span><span></span><span></span></span></p>
                </div>
                
                <div id="errorState" class="message-card__error" style="display: none;">
                    <div class="message-card__error-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="message-card__error-content">
                        <h3>Something went wrong</h3>
                        <p id="errorText">We couldn't create your message at this time.</p>
                        <button id="retryButton" class="secondary-button">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                </div>
                
                <div id="messageContent" class="message-card__content message-card__content--premium" style="display: block;">
                    <div class="message-card__header">
                        <div class="message-card__badge">
                            <i class="message-card__badge-icon fas fa-heart"></i>
                            <span>Created with HeartGlowAI</span>
                        </div>
                        <div class="message-card__date">
                            <i class="message-card__date-icon fas fa-calendar-alt"></i>
                            <span id="currentDate"></span>
                        </div>
                    </div>
                    
                    <div class="message-card__body">
                        <p id="content" class="message-card__text">
                            <span class="drop-cap">E</span>very moment with you feels like discovering a new chapter in the most beautiful story ever written. These two years have flown by, painting our canvas with colors I never knew existed. Your kindness, intelligence, and the way you care so deeply about everything around you continue to amaze me each day.

                            When I think about our journey together, I'm filled with profound gratitude. Thank you for being my partner, my confidant, and my favorite person to share life's adventures with. You've taught me what true appreciation means - seeing someone completely and valuing every part of who they are.

                            You make ordinary days extraordinary, simply by being you. I appreciate everything about us - our quiet moments, our silly jokes, our big dreams, and even our challenges that have made us stronger together.

                            With all my heart,
                            David
                        </p>
                    </div>
                    
                    <div class="message-card__actions">
                        <button id="editBtn" class="message-card__action">
                            <i class="message-card__action-icon fas fa-edit"></i>
                            <span>Edit</span>
                        </button>
                        <button id="copyBtn" class="message-card__action">
                            <i class="message-card__action-icon fas fa-copy"></i>
                            <span>Copy</span>
                        </button>
                        <button id="shareBtn" class="message-card__action">
                            <i class="message-card__action-icon fas fa-share-alt"></i>
                            <span>Share</span>
                        </button>
                        <button id="regenerateBtn" class="message-card__action">
                            <i class="message-card__action-icon fas fa-sync"></i>
                            <span>Regenerate</span>
                        </button>
                    </div>
                </div>
                
                <!-- Enhanced Message Insights Section -->
                <div id="messageInsights" class="message-insights">
                    <h3 class="message-insights__title">
                        <i class="message-insights__icon fas fa-lightbulb"></i>
                        Why This Message Works
                    </h3>
                    <div id="insightsContent" class="message-insights__content">
                        <div class="insight-item">
                            <strong>Personal Connection:</strong> The message references your specific relationship duration (two years), creating authenticity.
                        </div>
                        <div class="insight-item">
                            <strong>Specific Appreciation:</strong> It highlights specific qualities (kindness, intelligence, caring nature) that make the recipient feel truly seen.
                        </div>
                        <div class="insight-item">
                            <strong>Emotional Depth:</strong> The message balances everyday moments with deeper emotional connection, creating warmth.
                        </div>
                        <div class="insight-item">
                            <strong>Poetic Elements:</strong> Metaphors like "painting our canvas" add beauty without being overly flowery.
                        </div>
                    </div>
                    <div class="message-insights__actions">
                        <button id="copyInsightsBtn" class="message-insights__action">
                            <i class="message-insights__action-icon fas fa-copy"></i>
                            Copy Insights
                        </button>
                    </div>
                </div>
                
                <div id="editContainer" class="message-card__edit">
                    <textarea id="editMessage" class="message-card__edit-textarea"></textarea>
                    <div class="message-card__edit-actions">
                        <button id="cancelEditBtn" class="secondary-button">Cancel</button>
                        <button id="saveEditBtn" class="primary-button">Save Changes</button>
                    </div>
                </div>
            </div>
            
            <!-- Options for regenerating the message with different attributes -->
            <div id="regenerateOptions" class="regenerate-options" style="display: none;">
                <h3 class="options-title">Not quite right?</h3>
                <p class="options-description">You can try a different approach:</p>
                
                <div class="options-grid small-grid">
                    <div class="option-card small-card" data-variation="longer">
                        <div class="option-icon">
                            <i class="fas fa-plus"></i>
                        </div>
                        <h3 class="option-title">Longer</h3>
                        <p class="option-description">Add more content and detail</p>
                    </div>
                    
                    <div class="option-card small-card" data-variation="shorter">
                        <div class="option-icon">
                            <i class="fas fa-minus"></i>
                        </div>
                        <h3 class="option-title">Shorter</h3>
                        <p class="option-description">More concise and to the point</p>
                    </div>
                    
                    <div class="option-card small-card" data-variation="deeper">
                        <div class="option-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3 class="option-title">More Emotional</h3>
                        <p class="option-description">Add deeper emotional expression</p>
                    </div>
                    
                    <div class="option-card small-card" data-variation="different">
                        <div class="option-icon">
                            <i class="fas fa-random"></i>
                        </div>
                        <h3 class="option-title">Try Different</h3>
                        <p class="option-description">New approach, same parameters</p>
                    </div>
                </div>
                
                <!-- Added cancel button for regenerate options -->
                <button id="cancelRegenerateBtn" class="secondary-button" style="margin: 20px auto 0; display: block;">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
            
            <!-- Share Modal -->
            <div id="shareModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Share Your Message</h3>
                        <button id="closeShareModal" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="share-options">
                            <button class="share-option" data-platform="email">
                                <i class="fas fa-envelope"></i>
                                <span>Email</span>
                            </button>
                            <button class="share-option" data-platform="sms">
                                <i class="fas fa-comment"></i>
                                <span>Text Message</span>
                            </button>
                            <button class="share-option" data-platform="copy">
                                <i class="fas fa-link"></i>
                                <span>Copy Link</span>
                            </button>
                            <button class="share-option" data-platform="whatsapp">
                                <i class="fab fa-whatsapp"></i>
                                <span>WhatsApp</span>
                            </button>
                        </div>
                        
                        <div class="share-link-container">
                            <input type="text" id="shareLink" class="share-link" readonly>
                            <button id="copyShareLink" class="copy-button">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        
                        <div id="shareSuccess" class="share-success" style="display: none;">
                            <i class="fas fa-check-circle"></i>
                            <span>Link copied to clipboard!</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/message-result-new.js"></script>
    <script>
        // Fix for back button navigation
        document.addEventListener('DOMContentLoaded', function() {
            const backBtn = document.getElementById('backBtn');
            if (backBtn) {
                backBtn.addEventListener('click', function() {
                    window.location.href = 'message-tone-new.html';
                });
            }
            
            // Set current date
            const currentDateElem = document.getElementById('currentDate');
            if (currentDateElem) {
                const now = new Date();
                currentDateElem.textContent = now.toLocaleDateString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
            }
            
            // Ensure content is visible
            const messageContent = document.getElementById('messageContent');
            if (messageContent) {
                // Only force display if no message is being generated
                const loadingState = document.getElementById('loadingState');
                if (loadingState && loadingState.style.display === 'none') {
                    messageContent.style.display = 'block';
                }
            }
            
            // Setup share modal
            const shareBtn = document.getElementById('shareBtn');
            const shareModal = document.getElementById('shareModal');
            const closeShareModal = document.getElementById('closeShareModal');
            
            if (shareBtn && shareModal) {
                shareBtn.addEventListener('click', function() {
                    shareModal.classList.add('show');
                    shareModal.style.display = 'flex';
                    
                    // Generate share link
                    const shareLink = document.getElementById('shareLink');
                    if (shareLink) {
                        // Create a unique ID for this message
                        const uniqueId = Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
                        const shareUrl = `${window.location.origin}/shared-message.html?id=${uniqueId}`;
                        shareLink.value = shareUrl;
                    }
                });
            }
            
            if (closeShareModal && shareModal) {
                closeShareModal.addEventListener('click', function() {
                    shareModal.classList.remove('show');
                    setTimeout(() => {
                        shareModal.style.display = 'none';
                    }, 300);
                });
            }
            
            // Copy message link
            const copyShareLink = document.getElementById('copyShareLink');
            const shareLink = document.getElementById('shareLink');
            const shareSuccess = document.getElementById('shareSuccess');
            
            if (copyShareLink && shareLink && shareSuccess) {
                copyShareLink.addEventListener('click', function() {
                    shareLink.select();
                    document.execCommand('copy');
                    
                    shareSuccess.style.display = 'flex';
                    setTimeout(() => {
                        shareSuccess.style.display = 'none';
                    }, 3000);
                });
            }
            
            // Setup copy button
            const copyBtn = document.getElementById('copyBtn');
            const content = document.getElementById('content');
            
            if (copyBtn && content) {
                copyBtn.addEventListener('click', function() {
                    // Create a temporary textarea
                    const textarea = document.createElement('textarea');
                    textarea.value = content.innerText;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    
                    // Show success toast
                    showToast('Message copied to clipboard!');
                });
            }
            
            // Setup edit button
            const editBtn = document.getElementById('editBtn');
            const regenerateBtn = document.getElementById('regenerateBtn');
            
            if (editBtn) {
                editBtn.addEventListener('click', function() {
                    // For now just show a toast until edit functionality is implemented
                    showToast('Edit mode coming soon!');
                });
            }
            
            if (regenerateBtn) {
                regenerateBtn.addEventListener('click', function() {
                    const regenerateOptions = document.getElementById('regenerateOptions');
                    if (regenerateOptions) {
                        regenerateOptions.style.display = 'block';
                    }
                });
            }
            
            // Cancel regenerate
            const cancelRegenerateBtn = document.getElementById('cancelRegenerateBtn');
            if (cancelRegenerateBtn) {
                cancelRegenerateBtn.addEventListener('click', function() {
                    const regenerateOptions = document.getElementById('regenerateOptions');
                    if (regenerateOptions) {
                        regenerateOptions.style.display = 'none';
                    }
                });
            }
        });
        
        // Show toast notification
        function showToast(message, type = 'success') {
            // Check if a toast container already exists
            let toastContainer = document.querySelector('.toast-container');
            
            // Create the container if it doesn't exist
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container';
                document.body.appendChild(toastContainer);
            }
            
            // Create the toast element
            const toast = document.createElement('div');
            toast.className = `toast toast--${type}`;
            
            // Add icon based on type
            const icon = document.createElement('i');
            icon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            toast.appendChild(icon);
            
            // Add message
            const messageSpan = document.createElement('span');
            messageSpan.textContent = message;
            toast.appendChild(messageSpan);
            
            // Add the toast to the container
            toastContainer.appendChild(toast);
            
            // Remove the toast after a delay
            setTimeout(() => {
                toast.classList.add('toast-exit');
                
                // Remove the element after transition
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                    
                    // Remove the container if it's empty
                    if (toastContainer.children.length === 0 && toastContainer.parentNode) {
                        toastContainer.parentNode.removeChild(toastContainer);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html> 