(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[264],{5545:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/coaching/start",function(){return a(9062)}])},8477:function(e,t,a){"use strict";a.d(t,{db:function(){return c},l:function(){return i}});var n=a(3977),r=a(9451),o=a(6100);let i=(0,n.C6)().length?(0,n.C6)()[0]:(0,n.ZF)({apiKey:"AIzaSyBZiJPTs7dMccVgFV-YoTejnhy1bZNFEQY",authDomain:"heartglowai.firebaseapp.com",projectId:"heartglowai",storageBucket:"heartglowai.firebasestorage.app",messagingSenderId:"196565711798",appId:"1:196565711798:web:79e2b0320fd8e74ab0df17",measurementId:"G-KJMPL1DNPY"});(0,r.v0)(i);let c=(0,o.ad)(i)},9062:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return start}});var n=a(5893),r=a(7294),o=a(9008),i=a.n(o),c=a(1163),s=a(1810),d=a(9406),l=a(8549),h=a(6100),g=a(8477),coaching_StartCoachingChat=e=>{let{onClose:t}=e,{currentUser:a}=(0,l.a)(),o=(0,c.useRouter)(),[i,s]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[f,x]=(0,r.useState)(null),[m,p]=(0,r.useState)(!1),[y,b]=(0,r.useState)(null);(0,r.useEffect)(()=>{let fetchConnections=async()=>{if(a){u(!0);try{let e=(0,h.hJ)(g.db,"users",a.uid,"connections"),t=(0,h.IO)(e),n=await (0,h.PL)(t),r=n.docs.map(e=>({id:e.id,...e.data()}));s(r)}catch(e){console.error("Error fetching connections: ",e)}finally{u(!1)}}};fetchConnections()},[a]);let handleStartChat=async()=>{if(f&&a&&!m){p(!0),b(null);try{let e;let t=(0,h.hJ)(g.db,"coachingThreads"),n=(0,h.IO)(t,(0,h.ar)("userId","==",a.uid),(0,h.ar)("connectionId","==",f)),r=await (0,h.PL)(n);if(r.empty){console.log("No existing thread found for connection ".concat(f,". Creating new one."));let n=i.find(e=>e.id===f),r={userId:a.uid,connectionId:f,threadTitle:"Chat about ".concat((null==n?void 0:n.name)||"Connection"),lastActivity:(0,h.Bt)(),createdAt:(0,h.Bt)(),connectionSnapshot:n?{name:n.name,relationship:n.relationship}:void 0},o=await (0,h.ET)(t,r);e=o.id,console.log("Created new thread: ".concat(e))}else e=r.docs[0].id,console.log("Found existing thread: ".concat(e));o.push("/coaching/".concat(e))}catch(e){console.error("Error starting or finding chat thread: ",e),b("Could not start or find the chat thread. Please try again."),p(!1)}}};return(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4",children:"Start Coaching Chat"}),d?(0,n.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading connections..."}):0===i.length?(0,n.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No connections found. Add connections first."}):(0,n.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-2",children:i.map(e=>(0,n.jsxs)("div",{onClick:()=>x(e.id),className:"p-3 border rounded-md cursor-pointer transition-colors \n                ".concat(f===e.id?"bg-heartglow-pink/10 border-heartglow-pink ring-1 ring-heartglow-pink":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[(0,n.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),(0,n.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.relationship})]},e.id))}),(0,n.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,n.jsx)("button",{onClick:t,className:"px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800",children:"Cancel"}),(0,n.jsxs)("button",{onClick:handleStartChat,disabled:!f||d||m,className:"px-4 py-2 rounded-md border border-transparent shadow-sm font-medium text-white flex items-center justify-center\n            ".concat(!f||d||m?"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-heartglow-pink hover:bg-heartglow-pink/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink"),children:[m?(0,n.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):null,m?"Starting...":"Start Chat"]})]}),y&&(0,n.jsx)("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400 text-right",children:y})]})},start=()=>{let e=(0,c.useRouter)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i(),{children:[(0,n.jsx)("title",{children:"HeartGlow AI | Start Coaching Chat"}),(0,n.jsx)("meta",{name:"description",content:"Select a connection to start an AI coaching chat."})]}),(0,n.jsx)(d.Z,{children:(0,n.jsx)(s.Z,{children:(0,n.jsx)("div",{className:"max-w-2xl mx-auto py-8",children:(0,n.jsx)(coaching_StartCoachingChat,{onClose:()=>{e.push("/coaching")}})})})})]})}}},function(e){e.O(0,[424,270,774,888,179],function(){return e(e.s=5545)}),_N_E=e.O()}]);