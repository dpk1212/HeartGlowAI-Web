<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartGlowAI - Who's on your mind?</title>
    
    <!-- CRITICAL DISPLAY FIX: Force content to display no matter what -->
    <script>
        // Immediately execute to ensure content is displayed
        (function() {
            // Create and apply a style tag that forces visibility
            const forceDisplayStyle = document.createElement('style');
            forceDisplayStyle.textContent = `
                body, main, .card-container, .input-container, #new-connection-form,
                .relationship-type, .relationship-types, .form-group, .form-label,
                .relationship-icon, .relationship-label, .button-container,
                #back-btn, #next-btn, .save-option, .btn-container,
                .step-indicator, .page-title, .page-subtitle {
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                }
                
                .relationship-types {
                    display: grid !important;
                }
                
                .relationship-type {
                    background: rgba(255, 255, 255, 0.05) !important;
                    border: 1px solid rgba(255, 255, 255, 0.1) !important;
                    cursor: pointer !important;
                }
                
                .relationship-type.selected {
                    background: rgba(255, 107, 157, 0.15) !important;
                    border: 2px solid #ff6b9d !important;
                }
            `;
            document.head.appendChild(forceDisplayStyle);
            
            // Set a timer to force display again after page load
            window.setTimeout(function() {
                document.body.style.display = 'block';
                document.body.style.visibility = 'visible';
                const main = document.querySelector('main');
                if (main) {
                    main.style.display = 'block';
                    main.style.visibility = 'visible';
                    main.style.opacity = '1';
                }
                const form = document.getElementById('new-connection-form');
                if (form) {
                    form.style.display = 'block';
                    form.style.visibility = 'visible';
                }
                
                // Force relationship types to display
                const relationshipTypes = document.querySelectorAll('.relationship-type');
                if (relationshipTypes.length) {
                    relationshipTypes.forEach(type => {
                        type.style.display = 'block';
                        type.style.visibility = 'visible';
                        type.style.opacity = '1';
                    });
                }
            }, 100);
        })();
    </script>
    
    <!-- Add favicon as SVG to prevent 404 errors -->
    <script>
        // Add favicon
        const favicon = document.createElement('link');
        favicon.rel = 'icon';
        favicon.type = 'image/svg+xml';
        favicon.href = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z' fill='%23ff6b9d'/%3E%3C/svg%3E";
        document.head.appendChild(favicon);
    </script>
    
    <!-- CRITICAL CSS to ensure page loads -->
    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
            display: block !important;
            min-height: 100vh;
            visibility: visible !important;
        }
        
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        main {
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #ff6b9d;
            display: block !important;
        }
        
        .page-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 40px;
            display: block !important;
        }
        
        .input-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: block !important;
            visibility: visible !important;
        }
        
        .form-label {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: block !important;
            color: white;
        }
        
        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 16px;
            color: white;
            margin-bottom: 20px;
        }
        
        .relationship-types {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 16px;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .relationship-type {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .relationship-type.selected {
            background: rgba(255, 107, 157, 0.15);
            border: 2px solid #ff6b9d;
        }
        
        .relationship-icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: block !important;
        }
        
        .relationship-label {
            font-size: 14px;
            font-weight: 500;
            color: white;
            display: block !important;
        }
        
        .step-indicator {
            display: flex !important;
            justify-content: center;
            margin-bottom: 40px;
            visibility: visible !important;
        }
        
        .step-dot {
            width: 40px;
            height: 4px;
            border-radius: 2px;
            background-color: rgba(255, 255, 255, 0.1);
            margin: 0 5px;
        }
        
        .step-dot.active {
            background: linear-gradient(45deg, #ff6b9d, #7b2cbf);
            width: 60px;
        }
        
        .nav-bar button {
            background: none;
            border: none;
            color: white;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 14px;
            opacity: 0.7;
        }
        
        .nav-bar button:hover {
            opacity: 1;
        }
        
        .button-container {
            display: flex !important;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .next-button, .back-button, .btn, #back-btn, #next-btn {
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 16px;
            display: inline-block !important;
            visibility: visible !important;
        }
        
        .next-button, .btn-next, #next-btn {
            background: linear-gradient(45deg, #ff6b9d, #7b2cbf);
            color: white;
        }
        
        .back-button, .btn-back, #back-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .btn-container {
            display: flex !important;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        /* Error handling styles */
        .error-message {
            color: #ff4d4d;
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .error-message.visible {
            display: block;
        }
    </style>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/fix-visibility.css">
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    
    <script>
        // Initialize Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyBZiJPTs7dMccVgFV-YoTejnhy1bZNFEQY",
          authDomain: "heartglowai.firebaseapp.com",
          projectId: "heartglowai",
          storageBucket: "heartglowai.firebasestorage.app",
          messagingSenderId: "196565711798",
          appId: "1:196565711798:web:79e2b0320fd8e74ab0df17",
          measurementId: "G-KJMPL1DNPY"
        };
        
        // Initialize Firebase if not already initialized
        if (!window.firebase || !firebase.apps || !firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        
        // Critical: Set persistence to LOCAL
        if (firebase && firebase.auth) {
          firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
        }
    </script>
</head>
<body style="background-color: #121212 !important; color: white !important; visibility: visible !important; display: block !important;">
    <!-- Debug Console -->
    <div id="debug-console" style="display: block; position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.8); color: #0f0; padding: 10px; max-height: 200px; overflow: auto; font-family: monospace; z-index: 9999;">
        <div>
            Debug Console: 
            <button onclick="document.getElementById('debug-console').style.display='none'">Close</button>
            <button id="bypass-auth-btn" style="background: #ff6b9d; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-left: 10px; cursor: pointer;">Continue Without Login</button>
        </div>
        <div id="debug-output"></div>
    </div>
    
    <!-- Header and Navigation -->
    <header class="header">
        <div class="logo-container">
            <div class="logo-heart">❤️</div>
            <div class="logo-text">HeartGlowAI</div>
        </div>
        <nav class="nav-bar">
            <button id="dashboard-btn" class="nav-button">
                <i class="fas fa-columns"></i> Dashboard
            </button>
            <button id="history-btn" class="nav-button">
                <i class="fas fa-history"></i> History
            </button>
            <button id="learn-btn" class="nav-button">
                <i class="fas fa-brain"></i> Learn
            </button>
            <button id="logout-btn" class="nav-button">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </nav>
    </header>

    <main class="card-container" style="display: block !important; visibility: visible !important; opacity: 1 !important; max-width: 800px; margin: 30px auto; padding: 20px;">
        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
        </div>
        
        <h1 class="page-title">Who's on your mind?</h1>
        <p class="page-subtitle">Let's start with who you're writing to. This helps us personalize your message.</p>
        
        <!-- Saved Connections -->
        <div class="input-container" id="saved-connections-container" style="display: none;">
            <h3 class="form-label">Choose from your connections</h3>
            <div class="connections-container" id="connections-list">
                <!-- Connections will be loaded here dynamically -->
            </div>
            <p style="text-align: center; margin-top: 15px;">
                <a href="#" id="new-connection-link" style="color: var(--accent-pink); text-decoration: none;">
                    <i class="fas fa-plus-circle"></i> Add a new person
                </a>
            </p>
        </div>
        
        <!-- New Connection Form -->
        <div class="input-container" id="new-connection-form" style="display: block !important; visibility: visible !important;">
            <div class="form-group">
                <label class="form-label" for="recipient-name">Their name</label>
                <input type="text" id="recipient-name" class="form-input" placeholder="Enter their name">
            </div>
            
            <div class="form-group">
                <label class="form-label">Your relationship</label>
                <div class="relationship-types">
                    <div class="relationship-type" data-relation="partner">
                        <div class="relationship-icon">💑</div>
                        <div class="relationship-label">Partner</div>
                    </div>
                    <div class="relationship-type" data-relation="friend">
                        <div class="relationship-icon">🤝</div>
                        <div class="relationship-label">Friend</div>
                    </div>
                    <div class="relationship-type" data-relation="family">
                        <div class="relationship-icon">👪</div>
                        <div class="relationship-label">Family</div>
                    </div>
                    <div class="relationship-type" data-relation="colleague">
                        <div class="relationship-icon">💼</div>
                        <div class="relationship-label">Colleague</div>
                    </div>
                    <div class="relationship-type" data-relation="acquaintance">
                        <div class="relationship-icon">👋</div>
                        <div class="relationship-label">Acquaintance</div>
                    </div>
                    <div class="relationship-type" data-relation="other">
                        <div class="relationship-icon">✨</div>
                        <div class="relationship-label">Other</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Error message placeholder -->
        <div id="error-container" class="error-message">
            <p>We encountered an error loading some content. Please try refreshing the page or click "Continue Without Login" above.</p>
        </div>
        
        <div class="save-connection-container">
            <div class="save-option">
                <label class="toggle-switch">
                    <input type="checkbox" id="save-connection" class="toggle-input">
                    <span class="toggle-slider"></span>
                </label>
                <div>
                    <div class="option-label">Save this person to "My Connections"</div>
                    <div class="option-description">Add them to your contacts for future messages</div>
                </div>
            </div>
            
            <div class="save-option">
                <label class="toggle-switch">
                    <input type="checkbox" id="set-reminder" class="toggle-input">
                    <span class="toggle-slider"></span>
                </label>
                <div>
                    <div class="option-label">Remind me to message them again</div>
                    <div class="option-description">Set a future reminder to help maintain your connection</div>
                </div>
            </div>
            
            <div class="reminder-options" id="reminder-options">
                <div class="select-container">
                    <select id="reminder-timeframe" class="select-timeframe">
                        <option value="1-week">In 1 week</option>
                        <option value="2-weeks">In 2 weeks</option>
                        <option value="1-month" selected>In 1 month</option>
                        <option value="3-months">In 3 months</option>
                        <option value="custom">Custom date</option>
                    </select>
                </div>
                
                <div id="custom-date-container" style="display: none;">
                    <input type="date" id="custom-reminder-date" class="form-input">
                </div>
            </div>
        </div>
        
        <div class="btn-container">
            <button id="back-btn" class="btn btn-back">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <button id="next-btn" class="btn btn-next">
                Next <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </main>
    
    <!-- Ambient background particles -->
    <div class="particles-container">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <script>
        // Debug logging function
        function debugLog(message) {
            console.log('DEBUG:', message);
            const debugOutput = document.getElementById('debug-output');
            if (debugOutput) {
                const logEntry = document.createElement('div');
                logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                debugOutput.appendChild(logEntry);
            }
        }
        
        // Show debug console on certain errors
        window.addEventListener('error', function(e) {
            const debugConsole = document.getElementById('debug-console');
            if (debugConsole) {
                debugConsole.style.display = 'block';
                debugLog(`ERROR: ${e.message} at ${e.filename}:${e.lineno}`);
            }
            
            // Show the error message container
            const errorContainer = document.getElementById('error-container');
            if (errorContainer) {
                errorContainer.classList.add('visible');
            }
        });
        
        // Initialize bypass auth button
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('DOMContentLoaded event triggered in inline script');
            
            // Force visibility of critical elements
            document.body.style.display = 'block';
            document.body.style.visibility = 'visible';
            
            const mainContainer = document.querySelector('main');
            if (mainContainer) {
                mainContainer.style.display = 'block';
                mainContainer.style.visibility = 'visible';
                mainContainer.style.opacity = '1';
                debugLog('Main container forced visible in DOMContentLoaded');
            }
            
            const newConnectionForm = document.getElementById('new-connection-form');
            if (newConnectionForm) {
                newConnectionForm.style.display = 'block';
                newConnectionForm.style.visibility = 'visible';
                debugLog('Connection form forced visible');
            }
            
            const bypassAuthBtn = document.getElementById('bypass-auth-btn');
            if (bypassAuthBtn) {
                bypassAuthBtn.addEventListener('click', function() {
                    debugLog('🔓 AUTH BYPASS ACTIVATED - continuing without authentication');
                    // Force main form to be visible
                    const newConnectionForm = document.getElementById('new-connection-form');
                    if (newConnectionForm) {
                        newConnectionForm.style.display = 'block';
                    }
                    
                    // Disable connection saving features
                    const saveConnectionOption = document.getElementById('save-connection');
                    if (saveConnectionOption) {
                        saveConnectionOption.disabled = true;
                        saveConnectionOption.parentElement.parentElement.style.opacity = '0.5';
                    }
                    
                    document.getElementById('debug-output').innerHTML += 
                        '<div style="color:magenta">🚀 BYPASS ACTIVATED: Login skipped. You can continue using the form.</div>';
                });
            }
            
            // Also manually force relationship types visibility
            const relationshipTypes = document.querySelectorAll('.relationship-type');
            if (relationshipTypes.length) {
                debugLog(`Found ${relationshipTypes.length} relationship types, making them visible`);
                relationshipTypes.forEach(type => {
                    type.style.display = 'block';
                    type.style.visibility = 'visible';
                    type.style.opacity = '1';
                });
            } else {
                debugLog('ERROR: Relationship types not found');
            }
        });
        
        // Add debug button and ensure page is displayed immediately
        window.onload = function() {
            debugLog('Window onload triggered in inline script');
            
            // Ensure all content is visible regardless of other scripts
            document.body.style.display = 'block';
            document.body.style.visibility = 'visible';
            
            const mainContainer = document.querySelector('main');
            if (mainContainer) {
                mainContainer.style.display = 'block';
                mainContainer.style.visibility = 'visible';
                mainContainer.style.opacity = '1';
                debugLog('Force-showing main container in window.onload');
            }
            
            // Force relationship types visibility one more time
            const relationshipTypes = document.querySelectorAll('.relationship-type');
            if (relationshipTypes.length) {
                debugLog(`Force-showing ${relationshipTypes.length} relationship types in window.onload`);
                relationshipTypes.forEach(type => {
                    type.style.display = 'block';
                    type.style.visibility = 'visible';
                    type.style.opacity = '1';
                });
            }
            
            const debugBtn = document.createElement('button');
            debugBtn.textContent = 'Debug';
            debugBtn.style.position = 'fixed';
            debugBtn.style.bottom = '10px';
            debugBtn.style.right = '10px';
            debugBtn.style.zIndex = '9999';
            debugBtn.style.padding = '5px 10px';
            debugBtn.style.background = '#333';
            debugBtn.style.color = '#fff';
            debugBtn.style.border = 'none';
            debugBtn.style.borderRadius = '4px';
            debugBtn.style.cursor = 'pointer';
            
            debugBtn.addEventListener('click', function() {
                const debugConsole = document.getElementById('debug-console');
                if (debugConsole) {
                    debugConsole.style.display = debugConsole.style.display === 'none' ? 'block' : 'none';
                }
            });
            
            document.body.appendChild(debugBtn);
            
            // Log initial page load
            debugLog('Page fully loaded with window.onload');
            
            // Also log URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            for (const [key, value] of urlParams) {
                debugLog(`URL parameter: ${key} = ${value}`);
            }
            
            // Show debug console automatically
            const debugConsole = document.getElementById('debug-console');
            if (debugConsole) {
                debugConsole.style.display = 'block';
            }
        };
    </script>
    
    <!-- JavaScript -->
    <script src="js/recipient-selection.js"></script>
</body>
</html> 