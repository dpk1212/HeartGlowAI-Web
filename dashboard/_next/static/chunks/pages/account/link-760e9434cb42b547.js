(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[307],{6953:function(e,a,r){"use strict";r.d(a,{Z:function(){return o}});var t=r(1373);let o=(0,t.Z)("mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},3857:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account/link",function(){return r(5887)}])},5887:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return account_link}});var t=r(5893),o=r(7294),s=r(1503),n=r(1163),i=r(9008),l=r.n(i),d=r(9451),c=r(34),u=r(3495),g=r(1373);let h=(0,g.Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var m=r(6953);let p=(0,g.Z)("lock-keyhole",[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]]);var account_link=()=>{let{currentUser:e}=(0,s.a)(),a=(0,n.useRouter)(),[r,i]=o.useState(""),[g,y]=o.useState(""),[f,x]=o.useState(null),[k,b]=o.useState(!1),[w,v]=o.useState(!1);o.useEffect(()=>{e&&!e.isAnonymous&&(console.log("User is already permanent, redirecting from link page..."),a.replace("/"))},[e,a]);let handleLinkWithEmail=async t=>{if(t.preventDefault(),x(null),b(!0),!(null==e?void 0:e.isAnonymous)){x("No anonymous user found to link, or user state changed."),b(!1);return}console.log("Attempting to link with Email/Password...");try{let t=d.w9.credential(r,g);await (0,d.ZJ)(e,t),console.log("Email account linked successfully!"),a.push("/")}catch(e){if(console.error("Email linking error:",e),"object"==typeof e&&null!==e&&"code"in e)switch(e.code){case"auth/email-already-in-use":x("This email address is already associated with another account.");break;case"auth/invalid-credential":x("Incorrect email or password. Please try again.");break;case"auth/weak-password":x("Password is too weak. Please choose a stronger password.");break;case"auth/credential-already-in-use":x("This email/password is already linked to your account.");break;default:x("An unexpected error occurred: ".concat(e.message))}else x("An unexpected error occurred during email linking.")}finally{b(!1)}},handleLinkWithGoogle=async()=>{if(x(null),v(!0),!(null==e?void 0:e.isAnonymous)){x("No anonymous user found to link, or user state changed."),v(!1);return}console.log("Attempting to link with Google...");try{let r=new d.hJ,t=await (0,d.rh)(c.I8,r),o=d.hJ.credentialFromResult(t);if(!o)throw Error("Could not get Google credential from result.");await (0,d.ZJ)(e,o),console.log("Google account linked successfully!"),a.push("/")}catch(e){if(console.error("Google linking error:",e),"object"==typeof e&&null!==e&&"code"in e)switch(e.code){case"auth/credential-already-in-use":x("This Google account is already associated with another HeartGlow account or already linked.");break;case"auth/popup-closed-by-user":x("Google sign-in popup closed before completion.");break;case"auth/cancelled-popup-request":x("Multiple popups opened. Please close others and try again.");break;case"auth/unauthorized-domain":x("This domain isn't authorized for Google Sign-In. (Configuration Issue)");break;case"auth/user-mismatch":x("Cannot link credentials for different users.");break;default:x("An unexpected error occurred: ".concat(e.message))}else e instanceof Error?x(e.message):x("An unexpected error occurred during Google linking.")}finally{v(!1)}};return e?e.isAnonymous?(0,t.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-gray-100 via-purple-50 to-indigo-100 dark:from-gray-950 dark:via-heartglow-charcoal dark:to-indigo-900/50",children:[(0,t.jsx)(l(),{children:(0,t.jsx)("title",{children:"Secure Your Account - HeartGlow AI"})}),(0,t.jsxs)(u.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md p-8 md:p-10 space-y-6 bg-white dark:bg-gray-900/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700/50",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-6 rounded-full bg-gradient-to-br from-indigo-100 to-purple-100 dark:from-indigo-900/40 dark:to-purple-900/40 text-indigo-500 shadow-lg",children:(0,t.jsx)(h,{className:"w-8 h-8"})}),(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-heartglow-charcoal dark:text-heartglow-offwhite",children:"Secure Your Account"}),(0,t.jsx)("p",{className:"mt-3 text-base text-gray-600 dark:text-gray-300",children:"Save your progress permanently and access your messages across all devices by creating a free account."})]}),f&&(0,t.jsx)(u.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 bg-red-100 dark:bg-red-900/40 border border-red-300 dark:border-red-700/50 text-red-700 dark:text-red-300 rounded-lg text-sm text-center shadow-sm",children:f}),(0,t.jsxs)("form",{onSubmit:handleLinkWithEmail,className:"space-y-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:"Email address"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400",children:(0,t.jsx)(m.Z,{className:"h-4 w-4"})}),(0,t.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:r,onChange:e=>i(e.target.value),className:"appearance-none block w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-heartglow-pink/50 focus:border-heartglow-pink dark:bg-gray-800 dark:text-white transition duration-200",placeholder:"you@example.com"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:"Password"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400",children:(0,t.jsx)(p,{className:"h-4 w-4"})}),(0,t.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,value:g,onChange:e=>y(e.target.value),className:"appearance-none block w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-heartglow-pink/50 focus:border-heartglow-pink dark:bg-gray-800 dark:text-white transition duration-200",placeholder:"Create a password"})]})]}),(0,t.jsx)("button",{type:"submit",disabled:k||w,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-gradient-to-r from-heartglow-pink to-heartglow-violet hover:from-heartglow-pink/90 hover:to-heartglow-violet/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink dark:focus:ring-offset-gray-900 transition duration-300 disabled:opacity-60 disabled:cursor-not-allowed transform hover:scale-105",children:k?"Linking Email...":"Create Account with Email"})]}),(0,t.jsxs)("div",{className:"relative my-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:(0,t.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-700/50"})}),(0,t.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,t.jsx)("span",{className:"px-3 bg-white dark:bg-gray-900/80 text-gray-500 dark:text-gray-400",children:"Or"})})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("button",{type:"button",onClick:handleLinkWithGoogle,disabled:k||w,className:"w-full inline-flex justify-center items-center py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm bg-white dark:bg-gray-800 text-base font-medium text-heartglow-charcoal dark:text-heartglow-offwhite hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-900 transition duration-300 disabled:opacity-60 disabled:cursor-not-allowed",children:[(0,t.jsx)("svg",{className:"w-5 h-5 mr-3","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:(0,t.jsx)("path",{fill:"currentColor",d:"M488 261.8C488 403.3 381.5 512 244 512 110.3 512 0 401.7 0 261.8S110.3 11.6 244 11.6c67.3 0 120.3 24.1 162.6 63.9L349.3 127c-36.1-33.6-81.3-51.6-105.3-51.6-84.9 0-153.9 69.1-153.9 153.9s69 153.9 153.9 153.9c97.2 0 135.1-67.3 140.8-103.8H244v-71.5h244c2.6 12.9 3.9 26.7 3.9 41.4z"})}),w?"Linking Google...":"Continue with Google"]})}),(0,t.jsx)("p",{className:"mt-6 text-xs text-center text-gray-500 dark:text-gray-400",children:"By creating an account, you agree to our Terms of Service and Privacy Policy (links to be added)."})]})]}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-100 via-purple-50 to-indigo-100 dark:from-gray-950 dark:via-heartglow-charcoal dark:to-indigo-900/50",children:"Redirecting..."}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-100 via-purple-50 to-indigo-100 dark:from-gray-950 dark:via-heartglow-charcoal dark:to-indigo-900/50",children:"Loading user data..."})}}},function(e){e.O(0,[428,774,888,179],function(){return e(e.s=3857)}),_N_E=e.O()}]);