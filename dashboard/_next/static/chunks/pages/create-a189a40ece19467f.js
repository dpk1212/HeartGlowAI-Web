(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{7532:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/create",function(){return a(4724)}])},1798:function(e,t,a){"use strict";a.d(t,{HE:function(){return addConnection},HZ:function(){return updateConnection},Qf:function(){return updateConnectionWithMessage},RU:function(){return getConnectionFrequency},Rd:function(){return deleteConnection},S7:function(){return fetchUserConnections},SY:function(){return formatRelativeTime},db:function(){return n.db},eA:function(){return fetchUserMessages}});var r=a(6100),n=a(4417);let getConnectionFrequency=e=>{if(!e.messageCount||0===e.messageCount)return"new";if(!e.lastMessageDate)return"recent";let t=new Date,a=e.lastMessageDate.toDate(),r=Math.floor((t.getTime()-a.getTime())/864e5);return r<=7?"frequent":r<=30?"recent":"new"},fetchUserConnections=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e)return console.log("No authenticated user found for fetching connections"),[];try{console.log("Fetching connections for user ID: ".concat(e.uid));let a=(0,r.hJ)(n.db,"users/".concat(e.uid,"/connections")),o=(0,r.IO)(a,(0,r.Xo)("updatedAt","desc"),(0,r.b9)(t));console.log("Executing Firestore query for connections");let i=await (0,r.PL)(o);console.log("Retrieved ".concat(i.docs.length," connections from Firestore"));let s=i.docs.map(e=>{let t=e.data();return console.log("Connection found - ID: ".concat(e.id,", Name: ").concat(t.name,", Relationship: ").concat(t.relationship)),{id:e.id,...t}});return s}catch(e){return console.error("Error fetching connections:",e),[]}},fetchUserMessages=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e)return console.log("No authenticated user found for fetching messages"),[];try{console.log("Fetching messages for user ID: ".concat(e.uid));let a=(0,r.hJ)(n.db,"users/".concat(e.uid,"/messages")),o=(0,r.IO)(a,(0,r.Xo)("createdAt","desc"),(0,r.b9)(t));console.log("Executing Firestore query for messages");let i=await (0,r.PL)(o);console.log("Retrieved ".concat(i.docs.length," messages from Firestore"));let s=i.docs.map(e=>{let t=e.data();return console.log("Message found - ID: ".concat(e.id,", Recipient: ").concat(t.recipientName)),{id:e.id,...t}});return s}catch(e){return console.error("Error fetching messages:",e),[]}},addConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{let a=(0,r.hJ)(n.db,"users/".concat(e.uid,"/connections")),o=r.EK.now(),i={...t,createdAt:o,updatedAt:o,messageCount:0},s=await (0,r.ET)(a,i);return{id:s.id,...i}}catch(e){throw console.error("Error adding connection:",e),e}},updateConnectionWithMessage=async(e,t)=>{if(e&&t)try{let a=(0,r.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t));await (0,r.r7)(a,{messageCount:(0,r.nP)(1),lastMessageDate:(0,r.Bt)(),updatedAt:(0,r.Bt)()}),console.log("Updated connection ".concat(t," with new message info."))}catch(e){console.error("Error updating connection ".concat(t," after message:"),e)}},updateConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{let a=(0,r.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t.id)),o={...t,updatedAt:r.EK.now()};delete o.id,await (0,r.r7)(a,o);let i=await (0,r.QT)(a);return{id:t.id,...i.data()}}catch(e){throw console.error("Error updating connection:",e),e}},formatRelativeTime=e=>{if(!e)return"Never";let t=new Date,a=e.toDate(),r=t.getTime()-a.getTime(),n=Math.floor(r/864e5),o=Math.floor(r%864e5/36e5),i=Math.floor(r%36e5/6e4);return n>30?"".concat(Math.floor(n/30)," ").concat(1===Math.floor(n/30)?"month":"months"," ago"):n>0?"".concat(n," ").concat(1===n?"day":"days"," ago"):o>0?"".concat(o," ").concat(1===o?"hour":"hours"," ago"):i>0?"".concat(i," ").concat(1===i?"minute":"minutes"," ago"):"Just now"},deleteConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{console.log("Deleting connection with ID: ".concat(t," for user: ").concat(e.uid));let a=(0,r.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t));return await (0,r.oe)(a),console.log("Successfully deleted connection with ID: ".concat(t)),!0}catch(e){throw console.error("Error deleting connection:",e),e}}},3278:function(e,t,a){"use strict";a.d(t,{B:function(){return useChallenges}});var r=a(7294),n=a(6100),o=a(4417);function useChallenges(){let[e,t]=(0,r.useState)([]),[a,i]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let fetchChallenges=async()=>{i(!0),l(null);try{console.log("[useChallenges] Fetching active challenge definitions...");let e=(0,n.hJ)(o.db,"challenges"),a=(0,n.IO)(e,(0,n.ar)("isActive","==",!0)),r=await (0,n.PL)(a),i=r.docs.map(e=>({id:e.id,...e.data()}));console.log("[useChallenges] Fetched ".concat(i.length," active challenges.")),t(i)}catch(e){console.error("[useChallenges] Error fetching challenges:",e),l(e)}finally{i(!1)}};fetchChallenges()},[]),{challenges:e,loading:a,error:s}}},8477:function(e,t,a){"use strict";a.d(t,{db:function(){return l},l2:function(){return s}});var r=a(3977),n=a(9451),o=a(6100),i=a(8887);let s=(0,r.C6)().length?(0,r.C6)()[0]:(0,r.ZF)({apiKey:"AIzaSyBZiJPTs7dMccVgFV-YoTejnhy1bZNFEQY",authDomain:"heartglowai.firebaseapp.com",projectId:"heartglowai",storageBucket:"heartglowai.firebasestorage.app",messagingSenderId:"196565711798",appId:"1:196565711798:web:79e2b0320fd8e74ab0df17",measurementId:"G-KJMPL1DNPY"});(0,n.v0)(s);let l=(0,o.ad)(s);(0,i.Gb)().then(e=>e?(0,i.IH)(s):null)},4724:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return CreatePage}});var r=a(5893),n=a(7294),o=a(1163),i=a(1503),s=a(8477),l=a(6100),c=a(3495),d=a(1012),g=a(1664),u=a.n(g);function RecipientStep(e){let{onNext:t,initialData:a}=e;console.log(">>> RecipientStep component rendering started");let{currentUser:o}=(0,i.a)(),[g,m]=(0,n.useState)([]),[h,p]=(0,n.useState)(!0),[x,f]=(0,n.useState)(null),[y,b]=(0,n.useState)(null);(0,n.useEffect)(()=>{let fetchRecipients=async()=>{if(o)try{let e=(0,l.hJ)(s.db,"users",o.uid,"connections"),t=(0,l.IO)(e),r=await (0,l.PL)(t),n=r.docs.map(e=>({id:e.id,...e.data()}));if(m(n),null==a?void 0:a.id){let e=n.find(e=>e.id===a.id);e?f(e):(console.warn("Initial recipient ID not found in the current list."),f(null))}}catch(e){b("Failed to load recipients. Please try again."),console.error("Error fetching recipients:",e)}finally{p(!1)}};fetchRecipients()},[o,null==a?void 0:a.id]);let handleSelect=e=>{f(e)},formatLastContact=e=>{if(!e)return null;try{let t=e instanceof l.EK?e.toDate():new Date(e);if(isNaN(t.getTime()))return null;return t.toLocaleDateString()}catch(e){return console.error("Error formatting date:",e),null}};return h?(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-heartglow-pink"})}):(0,r.jsxs)("div",{className:"space-y-8 dark:text-heartglow-offwhite",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Who would you like to message?"}),(0,r.jsx)(u(),{href:"/connections/add",legacyBehavior:!0,children:(0,r.jsxs)("a",{className:"inline-flex items-center px-4 py-2 border border-gray-600 text-sm font-medium rounded-md shadow-sm text-gray-300 bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink focus:ring-offset-gray-900 transition-colors",children:[(0,r.jsx)(d.Z,{size:16,className:"-ml-1 mr-2"}),"Add Connection"]})})]}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:"Select a recipient from your connections"}),y&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative dark:bg-red-900/30 dark:border-red-700/50 dark:text-red-300",role:"alert",children:y}),(0,r.jsx)("div",{className:"grid gap-4",children:0===g.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No recipients found."}),(0,r.jsx)(u(),{href:"/connections/add",legacyBehavior:!0,children:(0,r.jsxs)("a",{className:"inline-flex items-center px-4 py-2 border border-gray-600 text-sm font-medium rounded-md shadow-sm text-gray-300 bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink focus:ring-offset-gray-900 transition-colors",children:[(0,r.jsx)(d.Z,{size:16,className:"-ml-1 mr-2"}),"Add Your First Connection"]})})]}):g.map(e=>{let t=formatLastContact(e.lastContact);return(0,r.jsx)(c.E.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"p-4 rounded-lg border cursor-pointer transition-all duration-200 ".concat((null==x?void 0:x.id)===e.id?"border-transparent ring-2 ring-heartglow-pink bg-gradient-to-br from-heartglow-pink/10 via-white to-heartglow-violet/10 dark:from-heartglow-pink/40 dark:to-heartglow-violet/40":"bg-white border-gray-200 hover:border-heartglow-pink/80 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-heartglow-pink"),onClick:()=>handleSelect(e),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 dark:text-heartglow-offwhite",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.specificRelationship||e.relationship})]}),t&&(0,r.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Last contact: ",t]})]})},e.id)})}),(0,r.jsx)("div",{className:"flex justify-end mt-8",children:(0,r.jsx)("button",{onClick:()=>{if(x){let e={recipient:{id:x.id,name:x.name,relationship:x.relationship},connectionData:{specificRelationship:x.specificRelationship,yearsKnown:x.yearsKnown,communicationStyle:x.communicationStyle,relationshipGoal:x.relationshipGoal,lastMessageDate:x.lastContact instanceof l.EK?x.lastContact.toDate():x.lastContact}};t(e)}},disabled:!x,className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink ".concat(x?"bg-heartglow-pink hover:bg-heartglow-pink/90":"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-gray-700 dark:text-gray-400"),children:"Next"})})]})}var m=a(6989),h=a(5169),p=a(7),x=a(2372),f=a(7737),y=a(6730);let b=[{id:"check-in",title:"Check In",description:"Simple message to see how they're doing",icon:"\uD83D\uDC4B",color:"from-blue-400 to-blue-600"},{id:"gratitude",title:"Gratitude",description:"Express appreciation",icon:"\uD83D\uDE4F",color:"from-heartglow-pink to-heartglow-violet"},{id:"support",title:"Support",description:"Offer help or encouragement",icon:"\uD83D\uDCAA",color:"from-green-400 to-teal-500"},{id:"celebration",title:"Celebration",description:"Share joy for achievements",icon:"\uD83C\uDF89",color:"from-yellow-400 to-orange-500"},{id:"reconnection",title:"Reconnection",description:"Reach out after time apart",icon:"\uD83E\uDD1D",color:"from-purple-400 to-indigo-500"},{id:"custom_intent",title:"Custom Intent",description:"Define your specific purpose",icon:"✍️",color:"from-gray-400 to-gray-600"}],w=[{id:"warm",label:"Warm",description:"Friendly and affectionate"},{id:"casual",label:"Casual",description:"Relaxed and informal"},{id:"sincere",label:"Sincere",description:"Honest and heartfelt"},{id:"playful",label:"Playful",description:"Light and fun"},{id:"formal",label:"Formal",description:"Professional and respectful"},{id:"reflective",label:"Reflective",description:"Thoughtful and introspective"},{id:"custom_tone",label:"Custom Tone",description:"Define your own tone"}],LabelledSlider=e=>{let{label:t,value:a,onChange:n,min:o=1,max:i=5,helpText:s,icon:l}=e,c=t.toLowerCase().includes("formality")?"formality":"depth";return(0,r.jsxs)("div",{className:"p-4 rounded-lg bg-gray-50 dark:bg-gray-800/30 border border-gray-200 dark:border-gray-700/50",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center",children:[l&&(0,r.jsx)(l,{size:16,className:"mr-2 opacity-70"}),t,s&&(0,r.jsxs)("span",{className:"ml-2 group relative",children:[(0,r.jsx)(m.Z,{size:14,className:"text-gray-400 cursor-help"}),(0,r.jsx)("span",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 p-2 bg-gray-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 shadow-lg",children:s})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("input",{type:"range",min:o,max:i,value:a,onChange:e=>n(parseInt(e.target.value,10)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-heartglow-violet/50"}),(0,r.jsx)("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 w-28 text-right tabular-nums",children:"formality"===c?["Very Casual","Casual","Neutral","Formal","Very Formal"][a-1]||"Neutral":["Lighthearted","Warm","Personal","Deeply Personal","Vulnerable"][a-1]||"Personal"})]})]})},SectionWrapper=e=>{let{title:t,description:a,children:n}=e;return(0,r.jsxs)("div",{className:"space-y-4 p-6 rounded-xl bg-white dark:bg-gray-800/20 border border-gray-200 dark:border-gray-700/30 shadow-sm",children:[(0,r.jsxs)("div",{className:"text-left mb-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white flex items-center",children:["Purpose"===t&&(0,r.jsx)(h.Z,{size:20,className:"mr-2 text-heartglow-pink"}),"Tone"===t&&(0,r.jsx)(p.Z,{size:20,className:"mr-2 text-heartglow-violet"}),"Style"===t&&(0,r.jsx)(x.Z,{size:20,className:"mr-2 text-blue-500"}),"Refine Goal"===t&&(0,r.jsx)(f.Z,{size:20,className:"mr-2 text-green-500"}),t]}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:a})]}),n]})};var create_PurposeToneStep=e=>{var t,a,o;let{onNext:i,onBack:s,initialData:l}=e,[d,g]=(0,n.useState)((null==l?void 0:null===(t=l.intent)||void 0===t?void 0:t.type)||null),[u,m]=(0,n.useState)((null==l?void 0:null===(a=l.intent)||void 0===a?void 0:a.type)==="custom_intent"&&l.intent.custom||""),[h,p]=(0,n.useState)((null==l?void 0:null===(o=l.intent)||void 0===o?void 0:o.type)==="custom_intent"),isStandardTone=e=>!!e&&w.some(t=>t.id===e&&"custom_tone"!==t.id),f=null!=l&&!!l.tone&&!isStandardTone(l.tone),[v,k]=(0,n.useState)(f?"custom_tone":(null==l?void 0:l.tone)||null),[j,N]=(0,n.useState)(f&&(null==l?void 0:l.tone)||""),[C,S]=(0,n.useState)(f),[E,D]=(0,n.useState)((null==l?void 0:l.formalityLevel)||3),[I,M]=(0,n.useState)((null==l?void 0:l.emotionalDepth)||3),[T,F]=(0,n.useState)((null==l?void 0:l.messageGoal)||"");(0,n.useEffect)(()=>{if(l){var e,t;let a=(null===(e=l.intent)||void 0===e?void 0:e.type)||null;g(a);let r="custom_intent"===a;p(r),m(r&&(null===(t=l.intent)||void 0===t?void 0:t.custom)||"");let n=l.tone||null,o=!!n&&!isStandardTone(n);k(o?"custom_tone":n),S(o),N(o&&n||""),D(l.formalityLevel||3),M(l.emotionalDepth||3),F(l.messageGoal||"")}else g(null),m(""),p(!1),k(null),N(""),S(!1),D(3),M(3),F("")},[l]);let handleIntentSelect=e=>{g(e),p("custom_intent"===e)},handleToneSelect=e=>{k(e),S("custom_tone"===e),"custom_tone"!==e&&N("")},P=!d||h&&!u.trim()||!v||C&&!j.trim();return(0,r.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-8 dark:text-heartglow-offwhite",children:[(0,r.jsxs)(SectionWrapper,{title:"Purpose",description:"What's the main goal of your message?",children:[(0,r.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:b.map(e=>(0,r.jsxs)(c.E.div,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},className:"p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 flex items-start space-x-3 ".concat(d===e.id?"border-heartglow-pink bg-heartglow-pink/5 dark:bg-heartglow-pink/10 shadow-md":"bg-white border-gray-200 hover:border-heartglow-pink/50 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:border-heartglow-pink/60"),onClick:()=>handleIntentSelect(e.id),children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br ".concat(e.color," text-white text-lg shadow-sm flex-shrink-0 mt-0.5"),children:e.icon}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-sm text-gray-900 dark:text-heartglow-offwhite",children:e.title}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})]},e.id))}),h&&(0,r.jsxs)(c.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700/50",children:[(0,r.jsx)("label",{htmlFor:"custom-intent",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Describe your custom intent:"}),(0,r.jsx)("textarea",{id:"custom-intent",value:u,onChange:e=>m(e.target.value),className:"w-full p-3 border rounded-lg bg-gray-50 text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent resize-none text-sm dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400",placeholder:"e.g., Invite to an event, ask for a favor...",rows:2,required:h})]})]}),(0,r.jsxs)(SectionWrapper,{title:"Tone",description:"How should the message feel?",children:[(0,r.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:w.map(e=>(0,r.jsx)(c.E.div,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>handleToneSelect(e.id),className:"p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ".concat(v===e.id?"border-heartglow-violet bg-heartglow-violet/5 dark:bg-heartglow-violet/10 shadow-md":"bg-white border-gray-200 hover:border-heartglow-violet/50 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:border-heartglow-violet/60"),children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-sm text-gray-900 dark:text-heartglow-offwhite",children:e.label}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})},e.id))}),C&&(0,r.jsxs)(c.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700/50",children:[(0,r.jsx)("label",{htmlFor:"custom-tone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Describe your desired tone:"}),(0,r.jsx)("input",{id:"custom-tone",type:"text",value:j,onChange:e=>N(e.target.value),className:"w-full p-3 border rounded-lg bg-gray-50 text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-violet focus:border-transparent text-sm dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400",placeholder:"e.g., Encouraging, Empathetic...",required:C})]})]}),(0,r.jsx)(SectionWrapper,{title:"Style",description:"Adjust the feeling of the message.",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(LabelledSlider,{label:"Formality",icon:y.Z,value:E,onChange:D,helpText:"How formal or casual?"}),(0,r.jsx)(LabelledSlider,{label:"Emotional Depth",icon:x.Z,value:I,onChange:M,helpText:"How personal or lighthearted?"})]})}),(0,r.jsx)(SectionWrapper,{title:"Refine Goal",description:"Optionally add more detail to the selected purpose.",children:(0,r.jsx)("input",{id:"messageGoal",type:"text",value:T,onChange:e=>F(e.target.value),placeholder:"e.g., Make them smile, ensure they understand the deadline...",className:"w-full p-3 border rounded-lg bg-gray-50 text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400"})}),(0,r.jsxs)("div",{className:"flex justify-between mt-10 pt-6 border-t border-gray-200 dark:border-gray-700/50",children:[(0,r.jsx)("button",{onClick:s,className:"inline-flex items-center justify-center px-5 py-2.5 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-lg shadow-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-colors",children:"Back"}),(0,r.jsx)("button",{onClick:()=>{let e=d?{type:d,custom:"custom_intent"===d?u.trim():void 0}:null,t=v?C?j.trim():v:null;e&&t?i({intent:e,tone:t,formalityLevel:E,emotionalDepth:I,messageGoal:T}):console.warn("Intent or Tone not selected")},disabled:P,className:"inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink dark:focus:ring-offset-gray-900 ".concat(P?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-gray-600 dark:text-gray-400":"bg-heartglow-pink hover:bg-heartglow-pink/90"),children:"Next"})]})]})},v=a(2560),k=a(7884),j=a(2546),N=a(3766),C=a(4617),S=a(5097);let E=[{id:"text",label:"Text Message",icon:"\uD83D\uDCF1",description:"Simple message for direct delivery"},{id:"email",label:"Email",icon:"\uD83D\uDCE7",description:"Formal message with subject line"},{id:"conversation",label:"In-Person Conversation",icon:"\uD83D\uDCAC",description:"Talking points for face-to-face"},{id:"card",label:"Greeting Card",icon:"\uD83D\uDC8C",description:"Perfect for celebration or gratitude"},{id:"social",label:"Social Media",icon:"\uD83C\uDF10",description:"Public post or direct message"},{id:"letter",label:"Letter",icon:"✉️",description:"Traditional format for deep connection"}],D=[{id:"Very short (1-2 sentences)",label:"Very Short",description:"1-2 sentences",icon:(0,r.jsx)(v.Z,{size:16})},{id:"Short (approx. 1 paragraph)",label:"Short",description:"~1 paragraph",icon:(0,r.jsx)(k.Z,{size:16})},{id:"Medium (approx. 2 paragraphs)",label:"Medium",description:"~2 paragraphs",icon:(0,r.jsx)(j.Z,{size:16})},{id:"Long (3+ paragraphs)",label:"Long",description:"3+ paragraphs",icon:(0,r.jsx)(N.Z,{size:16})}];var create_RefineGenerateStep=e=>{var t,a,o;let{onNext:i,onBack:s,initialData:l}=e,[d,g]=(0,n.useState)((null==l?void 0:null===(t=l.format)||void 0===t?void 0:t.type)||""),[u,m]=(0,n.useState)((null==l?void 0:null===(a=l.format)||void 0===a?void 0:a.length)||"Short (approx. 1 paragraph)"),[h,p]=(0,n.useState)((null==l?void 0:null===(o=l.format)||void 0===o?void 0:o.options)||{emailSubject:"",emojiPreference:"moderate",talkingPoints:3,platform:"general"}),x=[null==l?void 0:l.promptedBy,null==l?void 0:l.customInstructionsText].filter(Boolean).join("\n\n"),[f,y]=(0,n.useState)(x),[b,w]=(0,n.useState)((null==l?void 0:l.customInstructionsOptions)||{mentionMemory:!1,askQuestion:!1});(0,n.useEffect)(()=>{var e,t,a;g((null==l?void 0:null===(e=l.format)||void 0===e?void 0:e.type)||""),m((null==l?void 0:null===(t=l.format)||void 0===t?void 0:t.length)||"Short (approx. 1 paragraph)"),p((null==l?void 0:null===(a=l.format)||void 0===a?void 0:a.options)||{emailSubject:"",emojiPreference:"moderate",talkingPoints:3,platform:"general"});let r=[null==l?void 0:l.promptedBy,null==l?void 0:l.customInstructionsText].filter(Boolean).join("\n\n");y(r),w((null==l?void 0:l.customInstructionsOptions)||{mentionMemory:!1,askQuestion:!1})},[l]);let handleCheckboxChange=e=>{w(t=>({...t,[e]:!t[e]}))},v=!d;return(0,r.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-8 dark:text-heartglow-offwhite",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Delivery & Details"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Choose the final format and add specific instructions."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-6 p-6 rounded-xl bg-white dark:bg-gray-800/20 border border-gray-200 dark:border-gray-700/30 shadow-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-heartglow-offwhite mb-3 flex items-center",children:[(0,r.jsx)(C.Z,{size:18,className:"mr-2 text-heartglow-pink"})," Format"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3",children:E.map(e=>(0,r.jsxs)(c.E.div,{whileHover:{scale:1.03,y:-1},whileTap:{scale:.97},onClick:()=>g(e.id),className:"p-3 rounded-lg border-2 cursor-pointer transition-all duration-150 flex items-center space-x-2 text-sm ".concat(d===e.id?"border-heartglow-pink bg-heartglow-pink/5 dark:bg-heartglow-pink/10 shadow-md":"bg-white border-gray-200 hover:border-heartglow-pink/50 dark:bg-heartglow-deepgray dark:border-gray-600 dark:hover:border-heartglow-pink/60"),children:[(0,r.jsx)("span",{className:"text-lg",children:e.icon}),(0,r.jsx)("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:e.label})]},e.id))}),(()=>{switch(d){case"email":return(0,r.jsxs)(c.E.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 p-3 rounded-md bg-gray-50 dark:bg-gray-800/30 border border-gray-200 dark:border-gray-700/50",children:[(0,r.jsx)("label",{htmlFor:"email-subject",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Subject (Optional)"}),(0,r.jsx)("input",{id:"email-subject",type:"text",value:h.emailSubject,onChange:e=>p(t=>({...t,emailSubject:e.target.value})),className:"w-full p-2 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-1 focus:ring-heartglow-pink focus:border-heartglow-pink text-sm dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400",placeholder:"Enter email subject"})]});case"text":return(0,r.jsxs)(c.E.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 p-3 rounded-md bg-gray-50 dark:bg-gray-800/30 border border-gray-200 dark:border-gray-700/50",children:[(0,r.jsx)("label",{htmlFor:"emoji-usage",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Emoji Usage"}),(0,r.jsxs)("select",{id:"emoji-usage",value:h.emojiPreference,onChange:e=>p(t=>({...t,emojiPreference:e.target.value})),className:"w-full p-2 border rounded-lg bg-white text-gray-900 border-gray-300 focus:ring-1 focus:ring-heartglow-pink focus:border-heartglow-pink text-sm dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600",children:[(0,r.jsx)("option",{value:"moderate",children:"Moderate"}),(0,r.jsx)("option",{value:"minimal",children:"Minimal"}),(0,r.jsx)("option",{value:"frequent",children:"Frequent"}),(0,r.jsx)("option",{value:"none",children:"None"})]})]});case"conversation":return(0,r.jsxs)(c.E.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 p-3 rounded-md bg-gray-50 dark:bg-gray-800/30 border border-gray-200 dark:border-gray-700/50",children:[(0,r.jsx)("label",{htmlFor:"talking-points",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Number of Talking Points"}),(0,r.jsx)("input",{id:"talking-points",type:"number",min:"1",max:"10",value:h.talkingPoints,onChange:e=>p(t=>({...t,talkingPoints:parseInt(e.target.value,10)||1})),className:"w-full p-2 border rounded-lg bg-white text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-1 focus:ring-heartglow-pink focus:border-heartglow-pink text-sm dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400"})]});case"social":return(0,r.jsxs)(c.E.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 p-3 rounded-md bg-gray-50 dark:bg-gray-800/30 border border-gray-200 dark:border-gray-700/50",children:[(0,r.jsx)("label",{htmlFor:"platform",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Platform"}),(0,r.jsxs)("select",{id:"platform",value:h.platform,onChange:e=>p(t=>({...t,platform:e.target.value})),className:"w-full p-2 border rounded-lg bg-white text-gray-900 border-gray-300 focus:ring-1 focus:ring-heartglow-pink focus:border-heartglow-pink text-sm dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600",children:[(0,r.jsx)("option",{value:"general",children:"General"}),(0,r.jsx)("option",{value:"twitter",children:"Twitter"}),(0,r.jsx)("option",{value:"instagram",children:"Instagram"}),(0,r.jsx)("option",{value:"facebook",children:"Facebook"}),(0,r.jsx)("option",{value:"linkedin",children:"LinkedIn"})]})]});default:return null}})()]}),(0,r.jsxs)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700/50",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-heartglow-offwhite mb-3 flex items-center",children:[(0,r.jsx)(j.Z,{size:18,className:"mr-2 text-heartglow-violet"})," Length"]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:D.map(e=>(0,r.jsxs)(c.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>m(e.id),className:"px-3 py-1.5 rounded-full border text-xs font-medium flex items-center gap-1.5 transition-colors duration-150 ".concat(u===e.id?"border-transparent ring-2 ring-heartglow-violet bg-heartglow-violet/10 text-heartglow-violet dark:bg-heartglow-violet/20 dark:text-heartglow-violet-light shadow-sm":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50 hover:border-gray-400 dark:bg-gray-700 dark:border-gray-500 dark:text-gray-300 dark:hover:bg-gray-600"),children:[e.icon,e.label]},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-4 p-6 rounded-xl bg-white dark:bg-gray-800/20 border border-gray-200 dark:border-gray-700/30 shadow-sm",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-heartglow-offwhite mb-3 flex items-center",children:[(0,r.jsx)(S.Z,{size:18,className:"mr-2 text-blue-500"})," Context & Instructions"]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 -mt-2 mb-4",children:"Add background, specific points to include/avoid, or other guidance for the AI."}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400",children:"Quick Options:"}),(0,r.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"mentionMemory",type:"checkbox",checked:b.mentionMemory,onChange:()=>handleCheckboxChange("mentionMemory"),className:"h-4 w-4 text-heartglow-pink border-gray-300 rounded focus:ring-heartglow-pink dark:bg-gray-700 dark:border-gray-600"}),(0,r.jsx)("label",{htmlFor:"mentionMemory",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Mention specific memory/event"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"askQuestion",type:"checkbox",checked:b.askQuestion,onChange:()=>handleCheckboxChange("askQuestion"),className:"h-4 w-4 text-heartglow-pink border-gray-300 rounded focus:ring-heartglow-pink dark:bg-gray-700 dark:border-gray-600"}),(0,r.jsx)("label",{htmlFor:"askQuestion",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Include a question"})]})]})]}),(0,r.jsx)("textarea",{value:f,onChange:e=>y(e.target.value),placeholder:"e.g.,  • Prompt: Saw their vacation photos. • Goal: Ask about the trip, say I miss them. • Avoid mentioning work. • Mention the funny thing that happened last week.",className:"w-full p-3 border rounded-lg bg-gray-50 text-gray-900 border-gray-300 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm resize-y min-h-[120px] dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400/70",rows:6})]})]}),(0,r.jsxs)("div",{className:"flex justify-between mt-10 pt-6 border-t border-gray-200 dark:border-gray-700/50",children:[(0,r.jsx)("button",{onClick:s,className:"inline-flex items-center justify-center px-5 py-2.5 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-lg shadow-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-colors",children:"Back"}),(0,r.jsx)("button",{onClick:()=>{let e=d?{type:d,length:u,options:h}:null;e?i({format:e,contextInstructions:f.trim(),customInstructionsOptions:b}):console.warn("Format not selected")},disabled:v,className:"inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink dark:focus:ring-offset-gray-900 ".concat(v?"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-gray-600 dark:text-gray-400":"bg-heartglow-pink hover:bg-heartglow-pink/90"),children:"Generate Message"})]})]})},I=a(7004);async function generateMessage(e){try{console.log("[messageGenerator] Calling generateEnhancedMessage with params:",e);let t=(0,I.$C)(s.l2),a=(0,I.V1)(t,"generateEnhancedMessage"),r=await a({params:e}),n=r.data;if(n&&n.content)return console.log("[messageGenerator] Received response:",n),{content:n.content,insights:n.insights||[]};throw console.error("[messageGenerator] Cloud function returned invalid data structure:",n),Error("Invalid response structure from generation function")}catch(e){return console.error("[messageGenerator] Error calling generateEnhancedMessage function:",e),{content:"Sorry, we couldn't generate a message right now. ".concat(e.message||"Please try again later."," "),insights:[]}}}var M=a(1798),T=a(116),F=a(3742),P=a(6915),A=a(4464),R=a(9560),z=a(9503),G=a(3219),Z=a(9589),B=a(3278);function MessageOutput(e){let{recipient:t,connectionData:a,intent:d,format:g,tone:m,promptedBy:h,messageGoal:p,formalityLevel:x,emotionalDepth:f,customInstructionsText:y,customInstructionsOptions:b}=e,[w,v]=(0,n.useState)(!0),[k,j]=(0,n.useState)(!1),[N,C]=(0,n.useState)(""),[S,E]=(0,n.useState)([]),[D,L]=(0,n.useState)(null),{currentUser:_,userProfile:O}=(0,i.a)(),{challenges:J}=(0,B.B)(),[U,q]=(0,n.useState)(!0),H=(0,o.useRouter)(),[Q,W]=(0,n.useState)(!1),[V,K]=(0,n.useState)(!1),[Y,X]=(0,n.useState)(""),[$,ee]=(0,n.useState)([]),et=null==O?void 0:O.activeChallenge;et&&J.find(e=>e.id===et.challengeId);let autoSaveMessage=async(e,a)=>{if(!_||!t){console.warn("[autoSaveMessage] No user or recipient, cannot save message.");return}if(!e){console.warn("[autoSaveMessage] No message content generated, cannot save.");return}console.log("[autoSaveMessage] Attempting to save message for user:",_.uid);try{let r={content:e,recipientName:t.name,recipientId:t.id||null,relationship:t.relationship,intent:(null==d?void 0:d.type)||"unknown",tone:m||"neutral",formality:null!=x?x:3,depth:null!=f?f:3,promptContext:h||null,goalContext:p||null,createdAt:(0,l.Bt)(),insights:a,messageCategory:(null==d?void 0:d.type)||"unknown",messageFormat:(null==g?void 0:g.type)||"unknown",messageLength:(null==g?void 0:g.length)||"unknown",messageConfigTimestamp:new Date().toISOString(),appliedToChallenge:!!et&&U};console.log("[autoSaveMessage] Saving data:",r);let n=(0,l.hJ)(s.db,"users",_.uid,"messages"),o=await (0,l.ET)(n,r);console.log("[autoSaveMessage] Message auto-saved successfully with ID:",o.id);let i=(0,l.JU)(s.db,"users",_.uid);await (0,l.r7)(i,{totalMessageCount:(0,l.nP)(1)}),console.log("[autoSaveMessage] Incremented user totalMessageCount."),t.id?await (0,M.Qf)(_,t.id):console.warn("[autoSaveMessage] No recipient.id found, cannot update connection message count.")}catch(e){console.error("[autoSaveMessage] Error auto-saving message or updating counts:",e)}};(0,n.useEffect)(()=>{let generateAndSave=async()=>{let e="",r=[];if(!t||!d||!g||!m){L("Missing required information to generate message."),v(!1);return}try{let n;v(!0),L(null);let o={recipient:{name:t.name,relationship:t.relationship,id:t.id},connectionData:a||{},intent:d,format:g,tone:m,promptedBy:h||"",messageGoal:p||"",style:{formality:x||3,depth:f||3,length:g.length},customInstructions:{text:y||"",options:b||{}}};try{console.log("[generateAndSave] Calling generateMessage cloud function with params:",o),n=await generateMessage(o),console.log("[generateAndSave] Cloud function result:",n)}catch(e){throw console.warn("[generateAndSave] Cloud function failed, falling back:",e),e}if(n&&n.content)e=n.content,r=n.insights||[],C(e),E(r);else throw Error("Invalid response from generation function")}catch(e){console.error("Error generating message:",e),L("Failed to generate message. Please try again.")}finally{v(!1)}};generateAndSave()},[t,a,d,g,m,h,p,x,f,y,b]);let handleConfirmSave=async()=>{if(!N||!t){console.error("No message content or recipient to save.");return}if(console.log("handleConfirmSave triggered. applyToChallenge state:",U),await autoSaveMessage(N,S),U&&et){var e,a,r,n;let t=J.find(e=>e.id===et.challengeId),o=null!==(r=null!==(a=null==t?void 0:null===(e=t.criteria)||void 0===e?void 0:e.value)&&void 0!==a?a:et.goal)&&void 0!==r?r:1,i=null!==(n=et.progress)&&void 0!==n?n:0;console.log("[handleConfirmSave] Checking challenge completion: Progress=".concat(i,", Goal=").concat(o)),i+1>=Number(o)?(console.log("[handleConfirmSave] Challenge will be completed! Setting sessionStorage flag..."),sessionStorage.setItem("challengeCompleted","true"),sessionStorage.setItem("challengeCompletedTimestamp",Date.now().toString()),console.log("[handleConfirmSave] Challenge completion flag set. Confetti will show on dashboard.")):console.log("[handleConfirmSave] Challenge not yet completed by this message. Still needs more progress.")}else console.log("[handleConfirmSave] No active challenge or not applying to challenge.");handleCopyToClipboard(N),H.push("/")},handleCopyToClipboard=e=>{navigator.clipboard.writeText(e).then(()=>{j(!0),setTimeout(()=>j(!1),2e3)}).catch(e=>{console.error("Failed to copy:",e)})},generateInsightsAndGrade=async()=>{if(N&&t&&d&&m){K(!0);try{let e=(0,I.$C)(),a=(0,I.V1)(e,"generateMessageInsights"),r={message:N,recipient:{name:t.name,relationship:t.relationship},intent:d.type,tone:m};console.log(">>> Frontend: Payload being sent to generateMessageInsights:",JSON.stringify(r,null,2));let n=await a(r),o=n.data;if(o&&o.grade&&o.insights)X(o.grade),ee(o.insights),W(!0);else throw Error("Invalid response from insights generation")}catch(e){console.error("Error generating insights:",e),X("A-"),ee(["This message has a warm, personal tone that's perfect for your ".concat(null==t?void 0:t.relationship,"."),"The content is specific and thoughtful, showing genuine interest in reconnection.","By mentioning specific details, you create an authentic connection point."]),W(!0)}finally{K(!1)}}};if(w)return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center py-20 max-w-md mx-auto",children:[(0,r.jsx)(c.E.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 mb-6 rounded-full border-4 border-gray-600 border-t-heartglow-pink"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-300 mb-2",children:"Crafting your heartfelt message..."}),(0,r.jsx)("p",{className:"text-gray-400",children:"This may take just a moment."})]});if(D)return(0,r.jsxs)("div",{className:"text-center py-12 max-w-md mx-auto bg-gray-800/50 border border-red-500/30 rounded-xl p-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-900/30 text-red-400 rounded-full flex items-center justify-center mx-auto mb-5",children:(0,r.jsx)(T.Z,{size:32})}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-red-400 mb-3",children:D}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 inline-flex items-center justify-center bg-gray-600 hover:bg-gray-500 text-gray-100 font-medium rounded-lg px-6 py-2.5 transition-colors",children:"Try Again"})]});let ea=(null==t?void 0:t.name)||"them";return(0,r.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"max-w-3xl mx-auto py-8 md:py-12 space-y-8",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(c.E.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-3xl md:text-4xl font-bold bg-gradient-to-r from-heartglow-pink to-heartglow-violet text-transparent bg-clip-text mb-2",children:"Your Message Is Ready"}),(0,r.jsxs)(c.E.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-2 text-lg text-gray-400",children:["Crafted for ",ea," with ",(null==g?void 0:g.type)==="email"?"an email":"a message"," that conveys ",(null==d?void 0:d.type)||"your intention"]})]}),(0,r.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-br from-gray-800 to-gray-900 p-6 md:p-8 rounded-xl shadow-lg border border-gray-700/80",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-5",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold text-white",children:["Message for ",ea]}),(0,r.jsxs)("button",{onClick:()=>handleCopyToClipboard(N),className:"text-sm px-3 py-1.5 rounded-full transition-all duration-200 flex items-center focus:outline-none focus:ring-2 focus:ring-heartglow-pink focus:ring-offset-2 focus:ring-offset-gray-900 ".concat(k?"bg-green-600/80 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"),"aria-label":k?"Copied!":"Copy message",children:[k?(0,r.jsx)(F.Z,{size:16,className:"mr-1.5"}):(0,r.jsx)(P.Z,{size:16,className:"mr-1.5"}),k?"Copied!":"Copy"]})]}),(0,r.jsx)("div",{className:"bg-gray-900/50 p-5 rounded-lg border border-gray-700 min-h-[150px]",children:(0,r.jsx)("p",{className:"whitespace-pre-wrap text-gray-200 text-base md:text-lg leading-relaxed",children:N})})]}),(0,r.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Message Analysis"}),!Q&&(0,r.jsx)("button",{onClick:generateInsightsAndGrade,disabled:V,className:"inline-flex items-center justify-center px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-300 shadow-lg ".concat(V?"bg-gray-600 cursor-wait":"bg-gradient-to-r from-heartglow-pink to-heartglow-violet hover:scale-105"," text-white"),children:V?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-4 h-4 mr-2 rounded-full border-2 border-white border-t-transparent animate-spin"}),"Analyzing your message..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.Z,{size:16,className:"mr-2"}),"Reveal Message Analysis"]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(c.E.div,{initial:{scale:1},animate:{scale:Q?[1,1.05,1]:1,transition:{duration:.5,times:[0,.5,1]}},className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl shadow-xl border border-gray-700/50 overflow-hidden transform transition-all duration-500 hover:shadow-heartglow-pink/20",children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-700/60 bg-gray-800/60 flex justify-between items-center",children:(0,r.jsxs)("h4",{className:"font-medium text-white flex items-center",children:[(0,r.jsx)(R.Z,{size:18,className:"mr-2 text-yellow-400"}),"Message Grade"]})}),(0,r.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center relative min-h-[180px] transition-all duration-500",children:[Q?(0,r.jsxs)(c.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},className:"text-center",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"text-7xl font-bold bg-gradient-to-r from-yellow-300 to-heartglow-pink text-transparent bg-clip-text",children:Y}),(0,r.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5,duration:.3},className:"absolute -top-4 -right-6",children:(0,r.jsx)(R.Z,{size:24,className:"text-yellow-300 fill-yellow-300"})})]}),(0,r.jsx)(c.E.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"mt-4 text-gray-400 text-sm",children:"Based on intent, tone & relationship"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-32 h-32 rounded-full bg-gray-700/30 animate-pulse mb-4 flex items-center justify-center",children:(0,r.jsx)(R.Z,{size:32,className:"text-gray-600/50"})}),(0,r.jsx)("div",{className:"w-2/3 h-4 bg-gray-700/30 animate-pulse rounded-md"})]}),Q&&(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-yellow-500/5 to-heartglow-pink/5 rounded-xl pointer-events-none"})]})]}),(0,r.jsxs)(c.E.div,{initial:{y:0},animate:{y:Q?[0,-5,0]:0,transition:{duration:.5,delay:.1,times:[0,.5,1]}},className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl shadow-xl border border-gray-700/50 overflow-hidden transform transition-all duration-500 hover:shadow-heartglow-violet/20",children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-700/60 bg-gray-800/60",children:(0,r.jsxs)("h4",{className:"font-medium text-white flex items-center",children:[(0,r.jsx)(z.Z,{size:18,className:"mr-2 text-heartglow-pink"}),"Detailed Insights"]})}),(0,r.jsx)("div",{className:"p-6 min-h-[180px] overflow-y-auto ".concat(Q?"":"blur-lg select-none"," transition-all duration-500"),children:Q?(0,r.jsx)(c.E.ul,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"space-y-4 text-sm text-gray-300",children:$.map((e,t)=>(0,r.jsxs)(c.E.li,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.2+.1*t},className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-heartglow-pink mr-2 mt-1",children:"•"}),(0,r.jsx)("span",{children:e})]},t))}):(0,r.jsxs)("div",{className:"space-y-4 h-full flex flex-col justify-center",children:[(0,r.jsx)("div",{className:"w-full h-5 bg-gray-700/30 animate-pulse rounded-md"}),(0,r.jsx)("div",{className:"w-full h-5 bg-gray-700/30 animate-pulse rounded-md"}),(0,r.jsx)("div",{className:"w-3/4 h-5 bg-gray-700/30 animate-pulse rounded-md"})]})})]})]}),Q&&(0,r.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"text-center text-sm text-gray-500",children:"Powered by AI analysis to help you craft better messages"})]}),(0,r.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"flex justify-center gap-4 mt-8",children:[(0,r.jsx)(u(),{href:"/",children:(0,r.jsxs)("button",{className:"inline-flex items-center justify-center px-8 py-3 border border-gray-600 text-base font-medium rounded-full shadow-sm text-white bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-gray-900 transition-all duration-150 ease-in-out",children:[(0,r.jsx)(G.Z,{size:20,className:"mr-2"}),"Return to Dashboard"]})}),(0,r.jsxs)("button",{onClick:handleConfirmSave,className:"inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-full shadow-sm text-white bg-gradient-to-r from-heartglow-pink to-heartglow-violet hover:from-heartglow-pink/90 hover:to-heartglow-violet/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink focus:ring-offset-gray-900 transition-all duration-150 ease-in-out transform hover:scale-105",children:[(0,r.jsx)(Z.Z,{size:20,className:"mr-2"}),"Done - Save & Copy Message"]})]})]})}var L=a(1526);let _=[{number:1,label:"Recipient"},{number:2,label:"Message Essence"},{number:3,label:"Delivery & Details"}];function CreatePage(){console.log(">>> CreatePage component rendering started");let e=(0,o.useRouter)(),{currentUser:t,loading:a}=(0,i.a)(),[s,l]=(0,n.useState)(1),[d,g]=(0,n.useState)({recipient:null,connectionData:null,intent:null,format:null,tone:null,promptedBy:"",messageGoal:"",formalityLevel:3,emotionalDepth:3,customInstructionsText:"",customInstructionsOptions:{}});if((0,n.useEffect)(()=>{if(e.isReady){let{intent:t,tone:a}=e.query;(t||a)&&(console.log(">>> Query params found:",{queryIntent:t,queryTone:a}),g(e=>({...e,intent:t?{type:t,custom:""}:e.intent,tone:a||e.tone})))}},[e.isReady,e.query]),a)return(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-heartglow-pink"})});if(!t)return e.push("/login"),null;let handleNext=e=>{console.log(">>> Data received from step ".concat(s,":"),e),g(t=>({...t,...e})),l(e=>e+1)},handleBack=()=>{l(e=>e-1)};return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-heartglow-deepgray dark:to-gray-900 py-16 md:py-24",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"bg-white dark:bg-heartglow-deepgray text-gray-900 dark:text-gray-100 rounded-xl shadow-xl overflow-hidden p-8 sm:p-10",children:[s<=3&&(0,r.jsx)("div",{className:"mb-10 sm:mb-12",children:(0,r.jsx)("div",{className:"flex items-start justify-between",children:_.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center flex-grow justify-center flex-col sm:flex-row",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg mb-1 transition-all duration-300 ".concat(e.number<s?"bg-heartglow-pink text-white shadow-md":e.number===s?"bg-heartglow-violet text-white scale-110 shadow-lg":"bg-gray-200 dark:bg-gray-600 text-gray-500 dark:text-gray-400"),children:e.number}),(0,r.jsx)("span",{className:"text-xs sm:text-sm font-medium transition-colors duration-300 ".concat(e.number<=s?"text-heartglow-charcoal dark:text-heartglow-offwhite":"text-gray-400 dark:text-gray-500"),children:e.label})]}),t<_.length-1&&(0,r.jsx)("div",{className:"h-1 flex-grow mx-2 mt-5 hidden sm:block transition-colors duration-300 ".concat(e.number<s?"bg-heartglow-pink":"bg-gray-200 dark:bg-gray-600")})]},e.number))})}),(console.log(">>> CreatePage rendering step: ".concat(s)),(0,r.jsx)(L.M,{mode:"wait",children:(0,r.jsx)(c.E.div,{variants:{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50}},initial:"initial",animate:"animate",exit:"exit",transition:{duration:.3,ease:"easeInOut"},children:(()=>{switch(s){case 1:return(0,r.jsx)(RecipientStep,{onNext:handleNext,initialData:d.recipient});case 2:return(0,r.jsx)(create_PurposeToneStep,{onNext:handleNext,onBack:handleBack,initialData:{intent:d.intent,tone:d.tone,formalityLevel:d.formalityLevel,emotionalDepth:d.emotionalDepth,messageGoal:d.messageGoal}});case 3:return(0,r.jsx)(create_RefineGenerateStep,{onNext:handleNext,onBack:handleBack,initialData:{format:d.format,promptedBy:d.promptedBy,customInstructionsText:d.customInstructionsText,customInstructionsOptions:d.customInstructionsOptions}});case 4:return(0,r.jsx)(MessageOutput,{recipient:d.recipient,connectionData:d.connectionData,intent:d.intent,format:d.format,tone:d.tone,promptedBy:d.promptedBy,messageGoal:d.messageGoal,formalityLevel:d.formalityLevel,emotionalDepth:d.emotionalDepth,customInstructionsText:d.customInstructionsText,customInstructionsOptions:d.customInstructionsOptions});default:return null}})()},s)}))]})})})}}},function(e){e.O(0,[428,887,4,402,774,888,179],function(){return e(e.s=7532)}),_N_E=e.O()}]);