(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{118:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connections/add",function(){return r(8987)}])},1798:function(e,t,r){"use strict";r.d(t,{HE:function(){return addConnection},HZ:function(){return updateConnection},Qf:function(){return updateConnectionWithMessage},RU:function(){return getConnectionFrequency},Rd:function(){return deleteConnection},S7:function(){return fetchUserConnections},SY:function(){return formatRelativeTime},db:function(){return n.db},eA:function(){return fetchUserMessages}});var a=r(6100),n=r(4417);let getConnectionFrequency=e=>{if(!e.messageCount||0===e.messageCount)return"new";if(!e.lastMessageDate)return"recent";let t=new Date,r=e.lastMessageDate.toDate(),a=Math.floor((t.getTime()-r.getTime())/864e5);return a<=7?"frequent":a<=30?"recent":"new"},fetchUserConnections=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e)return console.log("No authenticated user found for fetching connections"),[];try{console.log("Fetching connections for user ID: ".concat(e.uid));let r=(0,a.hJ)(n.db,"users/".concat(e.uid,"/connections")),o=(0,a.IO)(r,(0,a.Xo)("updatedAt","desc"),(0,a.b9)(t));console.log("Executing Firestore query for connections");let s=await (0,a.PL)(o);console.log("Retrieved ".concat(s.docs.length," connections from Firestore"));let i=s.docs.map(e=>{let t=e.data();return console.log("Connection found - ID: ".concat(e.id,", Name: ").concat(t.name,", Relationship: ").concat(t.relationship)),{id:e.id,...t}});return i}catch(e){return console.error("Error fetching connections:",e),[]}},fetchUserMessages=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e)return console.log("No authenticated user found for fetching messages"),[];try{console.log("Fetching messages for user ID: ".concat(e.uid));let r=(0,a.hJ)(n.db,"users/".concat(e.uid,"/messages")),o=(0,a.IO)(r,(0,a.Xo)("createdAt","desc"),(0,a.b9)(t));console.log("Executing Firestore query for messages");let s=await (0,a.PL)(o);console.log("Retrieved ".concat(s.docs.length," messages from Firestore"));let i=s.docs.map(e=>{let t=e.data();return console.log("Message found - ID: ".concat(e.id,", Recipient: ").concat(t.recipientName)),{id:e.id,...t}});return i}catch(e){return console.error("Error fetching messages:",e),[]}},addConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{let r=(0,a.hJ)(n.db,"users/".concat(e.uid,"/connections")),o=a.EK.now(),s={...t,createdAt:o,updatedAt:o,messageCount:0},i=await (0,a.ET)(r,s);return{id:i.id,...s}}catch(e){throw console.error("Error adding connection:",e),e}},updateConnectionWithMessage=async(e,t)=>{if(e&&t)try{let r=(0,a.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t));await (0,a.r7)(r,{messageCount:(0,a.nP)(1),lastMessageDate:(0,a.Bt)(),updatedAt:(0,a.Bt)()}),console.log("Updated connection ".concat(t," with new message info."))}catch(e){console.error("Error updating connection ".concat(t," after message:"),e)}},updateConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{let r=(0,a.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t.id)),o={...t,updatedAt:a.EK.now()};delete o.id,await (0,a.r7)(r,o);let s=await (0,a.QT)(r);return{id:t.id,...s.data()}}catch(e){throw console.error("Error updating connection:",e),e}},formatRelativeTime=e=>{if(!e)return"Never";let t=new Date,r=e.toDate(),a=t.getTime()-r.getTime(),n=Math.floor(a/864e5),o=Math.floor(a%864e5/36e5),s=Math.floor(a%36e5/6e4);return n>30?"".concat(Math.floor(n/30)," ").concat(1===Math.floor(n/30)?"month":"months"," ago"):n>0?"".concat(n," ").concat(1===n?"day":"days"," ago"):o>0?"".concat(o," ").concat(1===o?"hour":"hours"," ago"):s>0?"".concat(s," ").concat(1===s?"minute":"minutes"," ago"):"Just now"},deleteConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{console.log("Deleting connection with ID: ".concat(t," for user: ").concat(e.uid));let r=(0,a.JU)(n.db,"users/".concat(e.uid,"/connections/").concat(t));return await (0,a.oe)(r),console.log("Successfully deleted connection with ID: ".concat(t)),!0}catch(e){throw console.error("Error deleting connection:",e),e}}},8987:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return add}});var a=r(5893),n=r(7294),o=r(1163),s=r(9008),i=r.n(s),c=r(3495),l=r(1664),d=r.n(l),u=r(1810),h=r(9406),g=r(8549),m=r(1798);function getRouteWithBasePath(e){return e.startsWith("http"),e}let x=["Family","Friend","Partner","Colleague","Client","Mentor","Mentee","Neighbor","Other"];var add=()=>{let e=(0,o.useRouter)(),{currentUser:t}=(0,g.a)(),[r,s]=(0,n.useState)(!1),[l,p]=(0,n.useState)(null),[f,y]=(0,n.useState)(!1),[b,w]=(0,n.useState)(""),[k,v]=(0,n.useState)(x[0]),[j,N]=(0,n.useState)(""),[C,S]=(0,n.useState)(""),[E,R]=(0,n.useState)(),[F,M]=(0,n.useState)(""),[A,D]=(0,n.useState)(""),[O,B]=(0,n.useState)(""),handleSubmit=async r=>{r.preventDefault();try{if(s(!0),p(null),!b.trim()){p("Please enter a name");return}let r={name:b.trim(),relationship:k,..."Other"===k&&{otherRelationship:j.trim()},...C&&{specificRelationship:C.trim()},...void 0!==E&&{yearsKnown:E},...F&&{communicationStyle:F.trim()},...A&&{relationshipGoal:A.trim()},...O&&{notes:O.trim()}};await (0,m.HE)(t,r),y(!0),w(""),v(x[0]),N(""),S(""),R(void 0),M(""),D(""),B(""),setTimeout(()=>{e.push(getRouteWithBasePath("/dashboard"))},1500)}catch(e){console.error("Error adding connection:",e),p(e.message||"Failed to add connection. Please try again.")}finally{s(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"Add Connection | HeartGlow AI"}),(0,a.jsx)("meta",{name:"description",content:"Add a new connection to HeartGlow AI"})]}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(u.Z,{children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsxs)(d(),{href:getRouteWithBasePath("/connections"),className:"text-heartglow-indigo dark:text-heartglow-pink hover:underline flex items-center mr-3",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-heartglow-charcoal dark:text-white",children:"Add New Connection"})]}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Add someone special to your connections to easily create personalized messages for them."})]}),(0,a.jsx)(c.E.div,{className:"bg-white dark:bg-heartglow-deepgray rounded-xl shadow-md border border-gray-100 dark:border-gray-800 p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:f?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-heartglow-charcoal dark:text-heartglow-offwhite mb-2",children:"Connection Added Successfully!"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Redirecting you back to dashboard..."})]}):(0,a.jsxs)("form",{onSubmit:handleSubmit,children:[l&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400",children:l}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",id:"name",value:b,onChange:e=>w(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-heartglow-pink focus:border-transparent",placeholder:"Enter their name",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"relationship",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Relationship ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("select",{id:"relationship",value:k,onChange:e=>v(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-heartglow-pink focus:border-transparent",required:!0,children:x.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),"Other"===k&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"otherRelationship",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Specify Relationship ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",id:"otherRelationship",value:j,onChange:e=>N(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-heartglow-pink focus:border-transparent",placeholder:"Specify their relationship to you",required:"Other"===k})]}),(0,a.jsxs)("div",{className:"Other"===k?"col-span-2":"col-span-1",children:[(0,a.jsx)("label",{htmlFor:"specificRelationship",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Specific Relationship (Optional)"}),(0,a.jsx)("input",{type:"text",id:"specificRelationship",value:C,onChange:e=>S(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-heartglow-pink focus:border-transparent",placeholder:"E.g. Brother, Boss, Best friend"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"yearsKnown",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Years Known (Optional)"}),(0,a.jsx)("input",{type:"number",id:"yearsKnown",value:E||"",onChange:e=>R(e.target.value?parseInt(e.target.value):void 0),min:"0",className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-heartglow-pink focus:border-transparent",placeholder:"How many years have you known them?"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{htmlFor:"communicationStyle",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Communication Style (Optional)"}),(0,a.jsx)("input",{type:"text",id:"communicationStyle",value:F,onChange:e=>M(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-heartglow-pink focus:border-transparent",placeholder:"How do they prefer to communicate?"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{htmlFor:"relationshipGoal",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Relationship Goal (Optional)"}),(0,a.jsx)("input",{type:"text",id:"relationshipGoal",value:A,onChange:e=>D(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-heartglow-pink focus:border-transparent",placeholder:"What do you hope to achieve in this relationship?"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes (Optional)"}),(0,a.jsx)("textarea",{id:"notes",value:O,onChange:e=>B(e.target.value),rows:4,className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-heartglow-pink focus:border-transparent",placeholder:"Any other details about this person you'd like to remember"})]})]}),(0,a.jsxs)("div",{className:"mt-8 flex justify-end space-x-4",children:[(0,a.jsx)(d(),{href:getRouteWithBasePath("/dashboard"),className:"px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:r,className:"px-6 py-2 bg-gradient-to-r from-heartglow-pink to-heartglow-violet text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 flex items-center ".concat(r?"opacity-70 cursor-not-allowed":""),children:r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Connection"})]})]})})]})})})]})}}},function(e){e.O(0,[664,428,270,774,888,179],function(){return e(e.s=118)}),_N_E=e.O()}]);