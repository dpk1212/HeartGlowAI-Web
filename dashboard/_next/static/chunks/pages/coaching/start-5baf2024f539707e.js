(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[264],{5545:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/coaching/start",function(){return r(9062)}])},8477:function(e,t,r){"use strict";r.d(t,{db:function(){return s},l2:function(){return c}});var a=r(3977),n=r(9451),o=r(6100),i=r(8887);let c=(0,a.C6)().length?(0,a.C6)()[0]:(0,a.ZF)({apiKey:"AIzaSyBZiJPTs7dMccVgFV-YoTejnhy1bZNFEQY",authDomain:"heartglowai.firebaseapp.com",projectId:"heartglowai",storageBucket:"heartglowai.firebasestorage.app",messagingSenderId:"196565711798",appId:"1:196565711798:web:79e2b0320fd8e74ab0df17",measurementId:"G-KJMPL1DNPY"});(0,n.v0)(c);let s=(0,o.ad)(c);(0,i.Gb)().then(e=>e?(0,i.IH)(c):null)},9062:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return start}});var a=r(5893),n=r(7294),o=r(9008),i=r.n(o),c=r(1163),s=r(1810),d=r(9406),l=r(1503),g=r(6100),h=r(8477),u=r(7004);let m=[{id:"improve_communication",label:"Improve Communication"},{id:"navigate_disagreement",label:"Navigate Disagreement"},{id:"express_appreciation",label:"Express Appreciation"},{id:"strengthen_connection",label:"Strengthen Connection"},{id:"open_chat",label:"Open Chat / Other"}],p=(0,u.$C)();var coaching_StartCoachingChat=e=>{let{onClose:t}=e,{currentUser:r}=(0,l.a)(),o=(0,c.useRouter)(),[i,s]=(0,n.useState)([]),[d,x]=(0,n.useState)(!0),[f,b]=(0,n.useState)(null),[y,k]=(0,n.useState)(null),[C,w]=(0,n.useState)(!1),[j,v]=(0,n.useState)(null);(0,n.useEffect)(()=>{let fetchConnections=async()=>{if(r){x(!0);try{let e=(0,g.hJ)(h.db,"users",r.uid,"connections"),t=(0,g.IO)(e),a=await (0,g.PL)(t),n=a.docs.map(e=>({id:e.id,...e.data()}));s(n)}catch(e){console.error("Error fetching connections: ",e)}finally{x(!1)}}};fetchConnections()},[r]);let handleStartChat=async()=>{if(f&&y&&r&&!C){w(!0),v(null);try{let e;let t=(0,g.hJ)(h.db,"coachingThreads"),a=(0,g.IO)(t,(0,g.ar)("userId","==",r.uid),(0,g.ar)("connectionId","==",f)),n=await (0,g.PL)(a),c=!1;if(n.empty){c=!0,console.log("No existing thread found for connection ".concat(f,". Creating new one."));let a=i.find(e=>e.id===f),n={userId:r.uid,connectionId:f,threadTitle:"Chat about ".concat((null==a?void 0:a.name)||"Connection"),lastActivity:(0,g.Bt)(),createdAt:(0,g.Bt)(),connectionSnapshot:a?{name:a.name,relationship:a.relationship}:void 0,initialPurpose:y},o=await (0,g.ET)(t,n);if(e=o.id,console.log("Created new thread: ".concat(e)),c){console.log("Triggering initial coach message for new thread: ".concat(e," with purpose: ").concat(y));try{let t=(0,u.V1)(p,"coachingAssistant");await t({threadId:e,initialPurpose:y}),console.log("Initial message trigger function called successfully for thread: ".concat(e))}catch(t){console.error("Error triggering initial coach message for thread ".concat(e,":"),t)}}}else e=n.docs[0].id,console.log("Found existing thread: ".concat(e));o.push("/coaching/".concat(e))}catch(e){console.error("Error starting or finding chat thread: ",e),v("Could not start or find the chat thread. Please try again."),w(!1)}}};return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4",children:"Start Coaching Chat"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"1. Select Connection"}),d?(0,a.jsx)("p",{children:"Loading connections..."}):0===i.length?(0,a.jsx)("p",{children:"No connections found."}):(0,a.jsx)("div",{className:"space-y-3 max-h-40 overflow-y-auto pr-2 mb-6 border rounded-md p-2 border-gray-300 dark:border-gray-600",children:i.map(e=>(0,a.jsxs)("div",{onClick:()=>b(e.id),className:"p-3 border rounded-md cursor-pointer transition-colors ".concat(f===e.id?"bg-heartglow-pink/10 border-heartglow-pink ring-1 ring-heartglow-pink":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.relationship})]},e.id))}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2 ".concat(f?"text-gray-700 dark:text-gray-300":"text-gray-400 dark:text-gray-600"),children:"2. Select Initial Purpose"}),(0,a.jsx)("div",{className:"space-y-2 ".concat(f?"":"opacity-50 pointer-events-none"),children:m.map(e=>(0,a.jsx)("div",{onClick:()=>k(e.id),className:"p-3 border rounded-md cursor-pointer transition-colors ".concat(y===e.id?"bg-indigo-100 dark:bg-indigo-900/40 border-indigo-500 dark:border-indigo-600 ring-1 ring-indigo-500":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"),children:(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.label})},e.id))}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:t,className:"px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800",children:"Cancel"}),(0,a.jsxs)("button",{onClick:handleStartChat,disabled:!f||!y||d||C,className:"px-4 py-2 rounded-md border border-transparent shadow-sm font-medium text-white flex items-center justify-center ".concat(!f||!y||d||C?"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-heartglow-pink hover:bg-heartglow-pink/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink"),children:[C?(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}):null,C?"Starting...":"Start Chat"]})]}),j&&(0,a.jsx)("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400 text-right",children:j})]})},start=()=>{let e=(0,c.useRouter)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"HeartGlow AI | Start Coaching Chat"}),(0,a.jsx)("meta",{name:"description",content:"Select a connection to start an AI coaching chat."})]}),(0,a.jsx)(d.Z,{children:(0,a.jsx)(s.Z,{children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto py-8",children:(0,a.jsx)(coaching_StartCoachingChat,{onClose:()=>{e.push("/coaching")}})})})})]})}},1163:function(e,t,r){e.exports=r(9974)}},function(e){e.O(0,[887,4,270,774,888,179],function(){return e(e.s=5545)}),_N_E=e.O()}]);