(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{1247:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/coaching/[threadId]",function(){return t(9244)}])},8477:function(e,r,t){"use strict";t.d(r,{db:function(){return o},l:function(){return d}});var a=t(3977),s=t(9451),n=t(6100);let d=(0,a.C6)().length?(0,a.C6)()[0]:(0,a.ZF)({apiKey:"AIzaSyBZiJPTs7dMccVgFV-YoTejnhy1bZNFEQY",authDomain:"heartglowai.firebaseapp.com",projectId:"heartglowai",storageBucket:"heartglowai.firebasestorage.app",messagingSenderId:"196565711798",appId:"1:196565711798:web:79e2b0320fd8e74ab0df17",measurementId:"G-KJMPL1DNPY"});(0,s.v0)(d);let o=(0,n.ad)(d)},9244:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return _threadId_}});var a=t(5893),s=t(7294),n=t(9008),d=t.n(n),o=t(1163),i=t(1810),c=t(9406),l=t(2469),h=t(8549),g=t(8477),u=t(6100),coaching_CoachingChatView=e=>{var r;let{threadId:t}=e,{currentUser:n}=(0,h.a)(),[d,o]=(0,s.useState)(null),[i,c]=(0,s.useState)([]),[m,f]=(0,s.useState)(!0),[x,p]=(0,s.useState)(!0),[b,y]=(0,s.useState)(null),[w,v]=(0,s.useState)(""),j=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!t)return;f(!0),y(null);let e=(0,u.JU)(g.db,"coachingThreads",t);(0,u.QT)(e).then(e=>{if(e.exists()){let r={id:e.id,...e.data()};r.userId===(null==n?void 0:n.uid)?o(r):(y("You don't have permission to view this chat."),console.error("User mismatch for thread access"))}else y("Chat thread not found.")}).catch(e=>{console.error("Error fetching thread data: ",e),y("Failed to load chat details.")}).finally(()=>{f(!1)})},[t,n]),(0,s.useEffect)(()=>{if(!t)return;p(!0),y(null);let e=(0,u.hJ)(g.db,"coachingThreads",t,"messages"),r=(0,u.IO)(e,(0,u.Xo)("timestamp","asc")),a=(0,u.cf)(r,e=>{let r=e.docs.map(e=>({id:e.id,...e.data()}));c(r),p(!1)},e=>{console.error("Error fetching messages: ",e),y("Failed to load messages."),p(!1)});return()=>a()},[t]),(0,s.useEffect)(()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[i]);let formatTimestamp=e=>{if(!e)return"";let r=e instanceof u.EK?e.toDate():e;return r.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0})};return m?(0,a.jsx)("div",{className:"flex justify-center items-center h-full p-6",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-heartglow-pink"})}):b?(0,a.jsxs)("div",{className:"p-6 text-center text-red-600 dark:text-red-400",children:["Error: ",b]}):d?(0,a.jsxs)("div",{className:"flex flex-col h-[calc(100vh-var(--header-height)-var(--footer-height)-2rem)] md:h-[calc(100vh-var(--header-height)-var(--footer-height)-4rem)] bg-white dark:bg-heartglow-deepgray border border-gray-200 dark:border-gray-700 rounded-lg shadow-md overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 truncate",children:[d.threadTitle,(null===(r=d.connectionSnapshot)||void 0===r?void 0:r.name)&&(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400 ml-2",children:["(Regarding: ",d.connectionSnapshot.name,")"]})]})}),(0,a.jsxs)("div",{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[x?(0,a.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-heartglow-pink"})}):0===i.length?(0,a.jsx)("p",{className:"text-center text-gray-500 dark:text-gray-400 pt-8",children:"Send a message to start the conversation."}):i.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"p-3 rounded-lg max-w-xs lg:max-w-md shadow-sm ".concat("user"===e.sender?"bg-heartglow-pink/90 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100"),children:[(0,a.jsx)("p",{className:"text-sm",children:e.content}),(0,a.jsx)("p",{className:"text-xs mt-1 ".concat("user"===e.sender?"text-pink-100/80":"text-gray-500 dark:text-gray-400"),children:formatTimestamp(e.timestamp)})]})},e.id)),(0,a.jsx)("div",{ref:j})]}),(0,a.jsx)("div",{className:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),w.trim()&&n&&t&&(console.log("TODO: Send message for thread ".concat(t,":"),w),v(""))},className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"text",placeholder:"Talk to your coach...",value:w,onChange:e=>v(e.target.value),className:"flex-grow bg-white text-gray-900 border border-gray-300 rounded-md p-3 placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent dark:bg-gray-700 dark:text-heartglow-offwhite dark:border-gray-600 dark:placeholder-gray-400","aria-label":"Message input",disabled:m||x}),(0,a.jsx)("button",{type:"submit",disabled:!w.trim()||m||x,"aria-label":"Send message",className:"shrink-0 inline-flex items-center justify-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink ".concat(!w.trim()||m||x?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-heartglow-pink hover:bg-heartglow-pink/90"),children:(0,a.jsx)(l.kcA,{className:"h-5 w-5"})})]})})]}):(0,a.jsx)("div",{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"Chat not found or access denied."})},_threadId_=()=>{let e=(0,o.useRouter)(),{threadId:r}=e.query;return r&&"string"==typeof r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d(),{children:[(0,a.jsx)("title",{children:"HeartGlow AI | Coaching Chat"}),(0,a.jsx)("meta",{name:"description",content:"AI coaching chat for thread ".concat(r)})]}),(0,a.jsx)(c.Z,{children:(0,a.jsx)(i.Z,{children:(0,a.jsx)(coaching_CoachingChatView,{threadId:r})})})]}):(0,a.jsx)(c.Z,{children:(0,a.jsx)(i.Z,{children:(0,a.jsx)("div",{className:"p-6 text-center",children:"Loading chat or invalid thread ID..."})})})}}},function(e){e.O(0,[409,424,270,774,888,179],function(){return e(e.s=1247)}),_N_E=e.O()}]);