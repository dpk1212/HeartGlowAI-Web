<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HeartGlowAI</title>
  <meta name="description" content="AI-powered heartfelt message generator for all your relationships. Create authentic messages for loved ones.">
  
  <!-- Resource Hints -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://us-central1-heartglowai.cloudfunctions.net" crossorigin>
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>
  <link rel="preload" href="css/styles.css" as="style">
  <link rel="preload" href="js/main.js" as="script">
  
  <!-- Font Loading -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/perplexity-citations.css">
</head>
<body>
  <div id="app">
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen active">
      <div class="welcome-container">
        <!-- Logo Header -->
        <div class="brand-header">
          <div class="logo-heart"></div>
          <h1 class="brand-name">HeartGlowAI</h1>
        </div>
        
        <div class="welcome-content">
          <h2 class="main-heading">What kind of message is on your heart today?</h2>
          
          <!-- Message Type Selection Cards -->
          <div class="message-type-grid">
            <!-- Romantic Card -->
            <div class="message-type-card" id="romantic-type">
              <div class="card-icon">❤️</div>
              <h3 class="card-title">Romantic</h3>
              <p class="card-sample">I miss you. I just didn't know how to say it.</p>
            </div>
            
            <!-- Professional Card -->
            <div class="message-type-card" id="professional-type">
              <div class="card-icon">👔</div>
              <h3 class="card-title">Professional</h3>
              <p class="card-sample">You helped more than you know.</p>
            </div>
            
            <!-- Personal Card -->
            <div class="message-type-card" id="personal-type">
              <div class="card-icon">💬</div>
              <h3 class="card-title">Personal</h3>
              <p class="card-sample">It's been a while. I just wanted to reach out.</p>
            </div>
          </div>
          
          <!-- Next Button (initially hidden, shown when a card is selected) -->
          <button id="next-step-btn" class="primary-button" style="display: none;">Next</button>
        </div>
      </div>
    </div>
    
    <!-- Message Creation Flow Screen (shown after selection) -->
    <div id="message-flow-screen" class="screen">
      <div class="flow-container">
        <button id="back-to-types-btn" class="back-button">← Back</button>
        
        <div class="selected-type-indicator">
          <span id="selected-type-icon">💌</span>
          <span id="selected-type-text">Type</span> Message
        </div>
        
        <div class="flow-section scenarios-section">
          <h3>Common Scenarios</h3>
          <div class="scenario-cards">
            <div class="scenario-card" data-scenario="reconnect">
              <div class="scenario-icon">🔄</div>
              <div class="scenario-title">Reconnect</div>
              <div class="scenario-desc">When you haven't spoken in a while</div>
            </div>
            <div class="scenario-card" data-scenario="appreciation">
              <div class="scenario-icon">🙏</div>
              <div class="scenario-title">Appreciation</div>
              <div class="scenario-desc">Show gratitude for someone</div>
            </div>
            <div class="scenario-card" data-scenario="missing">
              <div class="scenario-icon">💭</div>
              <div class="scenario-title">Missing Someone</div>
              <div class="scenario-desc">Let them know they're on your mind</div>
            </div>
          </div>
        </div>
        
        <div class="flow-section mistakes-section">
          <h3>Common Mistakes to Avoid</h3>
          <ul class="mistakes-list">
            <li>Being too generic and not personalizing the message</li>
            <li>Overwhelming with too much emotion too quickly</li>
            <li>Using unclear language that could be misinterpreted</li>
            <li>Forgetting to express genuine interest in the other person</li>
          </ul>
        </div>
        
        <div class="flow-section example-section">
          <h3>Example Message</h3>
          <div class="example-message">
            <p id="example-message-text">I've been thinking about you lately. The little things keep reminding me of our time together, and I realized I never properly expressed how much you mean to me.</p>
          </div>
          <div class="example-insights">
            <h4>Why This Works:</h4>
            <ul>
              <li>Opens with a personal touch that shows genuine thought</li>
              <li>References shared experiences to establish connection</li>
              <li>Expresses authentic feelings without overwhelming</li>
              <li>Leaves room for the other person to respond naturally</li>
            </ul>
          </div>
        </div>
        
        <div class="flow-section create-section">
          <h3>Create Your Own Message</h3>
          <p>Ready to write a heartfelt message that truly connects?</p>
          <button id="create-message-btn" class="primary-button">Get Started</button>
          <p class="no-account-note">No account needed - try it now!</p>
        </div>
      </div>
    </div>
    
    <!-- Auth Screen -->
    <div id="auth-screen" class="screen">
      <div class="auth-container">
        <div class="auth-logo"></div>
        <h1 class="auth-title">Log in or sign up</h1>
        
        <!-- Add Google Sign In button -->
        <button id="google-sign-in" class="google-btn">
          <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=" alt="Google logo">
          Continue with Google
        </button>
        
        <div class="auth-divider">
          <span>or continue with email</span>
        </div>
        
        <form id="auth-form" class="auth-form">
          <label class="input-label" for="email">Email</label>
          <input type="email" id="email" class="input-field" placeholder="Enter your email">
          
          <label class="input-label" for="password">Password</label>
          <input type="password" id="password" class="input-field" placeholder="Enter your password">
          
          <button type="submit" id="auth-submit-btn" class="btn">Continue</button>
        </form>
        <div class="auth-links">
          <span id="auth-toggle-text">Don't have an account?</span>
          <a href="#" id="auth-toggle-link" class="auth-link">Sign up</a>
        </div>
        <div class="auth-links">
          <a href="#" id="forgot-password-link" class="auth-link">Forgot password?</a>
        </div>
      </div>
    </div>
    
    <!-- Home Screen -->
    <div id="home-screen" class="screen">
      <div class="header">
        <div class="logo-container">
          <div class="logo-heart"></div>
          <span class="logo-text">HeartGlowAI</span>
        </div>
      </div>
      
      <div class="home-header">
        <h1 class="home-title">Start a meaningful conversation</h1>
        <p class="home-subtitle">Choose a template or start fresh — we'll guide you.</p>
      </div>
      
      <div class="home-actions">
        <button id="dashboard-btn" class="settings-btn">
          <span class="settings-icon">📊</span> Dashboard
        </button>
        
        <button id="history-btn" class="settings-btn">
          <span class="settings-icon">📋</span> History
        </button>
        
        <button id="learn-btn" class="settings-btn">
          <span class="settings-icon">🧠</span> Learn
        </button>
        
        <button id="logout-btn" class="settings-btn">
          <span class="settings-icon">👤</span> Logout
        </button>
      </div>
      
      <button id="new-conversation-btn" class="new-conversation-btn">
        <span class="new-conversation-icon">💬</span> Start a New Conversation
      </button>
      
      <!-- Templates Section -->
      <div id="templates-section" class="templates-section">
        <h2 class="section-title">Message Templates</h2>
        
        <!-- Everyday Check-ins Category -->
        <div class="template-category">
          <h3 class="category-title">Everyday Check-Ins</h3>
          <div class="templates-grid">
            <div class="template-card" data-template="checkin">
              <div class="template-icon">👋</div>
              <div class="template-name">Check-In</div>
              <div class="template-description">Reconnect with someone you haven't spoken to in a while</div>
            </div>
            <div class="template-card" data-template="encouragement">
              <div class="template-icon">⭐</div>
              <div class="template-name">Encouragement</div>
              <div class="template-description">Offer support during a challenging time</div>
            </div>
          </div>
        </div>
        
        <!-- Repair & Reconnect Category -->
        <div class="template-category">
          <h3 class="category-title">Repair & Reconnect</h3>
      <div class="templates-grid">
        <div class="template-card" data-template="apology">
              <div class="template-icon">✉️</div>
          <div class="template-name">Apology</div>
              <div class="template-description">Make amends with empathy and sincerity</div>
        </div>
            <div class="template-card" data-template="tough">
              <div class="template-icon">💬</div>
              <div class="template-name">Tough Talk</div>
              <div class="template-description">Navigate a difficult conversation with respect</div>
            </div>
          </div>
        </div>
        
        <!-- Celebrate & Appreciate Category -->
        <div class="template-category">
          <h3 class="category-title">Celebrate & Appreciate</h3>
          <div class="templates-grid">
        <div class="template-card" data-template="romantic">
              <div class="template-icon">❤️</div>
          <div class="template-name">Romantic</div>
              <div class="template-description">Express your love and affection</div>
        </div>
            <div class="template-card" data-template="gratitude">
              <div class="template-icon">🙏</div>
              <div class="template-name">Gratitude</div>
              <div class="template-description">Show appreciation for their support</div>
        </div>
            <div class="template-card" data-template="celebration">
              <div class="template-icon">🎉</div>
              <div class="template-name">Celebration</div>
              <div class="template-description">Congratulate someone on their achievement</div>
        </div>
            <div class="template-card" data-template="sympathy">
              <div class="template-icon">💐</div>
              <div class="template-name">Sympathy</div>
              <div class="template-description">Offer comfort during a difficult time</div>
            </div>
          </div>
        </div>
        
        <button id="feedbackButton" class="feedback-button">
          <span class="feedback-icon">⭐</span> Submit Feedback
        </button>
      </div>
      
      <div class="dashboard-section">
          <h3>Your Relationships</h3>
          <button id="manage-blueprints-btn" class="tertiary-button">Manage Relationship Blueprints</button>
      </div>
      
      <div class="recent-messages">
          <h3>Recent Messages</h3>
          <ul id="message-history"></ul>
      </div>
    </div>
    
    <!-- Message Generator Screen -->
    <div id="generator-screen" class="screen">
      <button id="back-to-home-btn" class="back-button">
        <span class="back-icon">←</span> Back
      </button>
      
      <div class="generator-container">
        <div class="form-container">
          <div class="input-group">
            <label for="scenario">What would you like to say?</label>
            <textarea id="scenario" placeholder="Example: I want to express my gratitude for their support during a difficult time"></textarea>
          </div>
          
          <div class="input-group">
            <label for="relationship">Relationship Type</label>
            <select id="relationship">
              <option value="Friend">Friend</option>
              <option value="Romantic Partner">Romantic Partner</option>
              <option value="Family Member">Family Member</option>
              <option value="Professional">Professional</option>
              <option value="Mentor">Mentor</option>
            </select>
          </div>
          
          <div class="input-group">
            <label for="tone">Message Tone</label>
            <select id="tone">
              <option value="casual">Casual</option>
              <option value="formal">Formal</option>
              <option value="humorous">Humorous</option>
              <option value="serious">Serious</option>
              <option value="poetic">Poetic</option>
              <option value="professional">Professional</option>
            </select>
          </div>
          
          <div class="input-group">
            <label for="intensity">Tone Intensity</label>
            <div class="slider-container">
              <input type="range" id="intensity" min="1" max="5" value="3" class="slider">
              <div class="slider-labels">
                <span>Subtle</span>
                <span>Balanced</span>
                <span>Strong</span>
              </div>
            </div>
          </div>
          
          <div class="input-group">
            <label for="duration">Relationship Duration</label>
            <select id="duration">
              <option value="unspecified">Not specified</option>
              <option value="new">New/Recent</option>
              <option value="few months">Few months</option>
              <option value="1-5 years">1-5 years</option>
              <option value="5+ years">5+ years</option>
              <option value="lifelong">Lifelong</option>
            </select>
          </div>
          
          <div class="input-group">
            <label for="circumstances">Special Circumstances (Optional)</label>
            <textarea id="circumstances" placeholder="Example: We recently had an argument, or They're going through a tough time"></textarea>
          </div>
          
          <button id="generateBtn" class="primary-button">
            <span class="button-content">
              Generate Message
              <span class="button-icon">✨</span>
            </span>
          </button>
        </div>
        
        <div id="result" class="result-card" style="display: none;">
          <div class="result-layout">
            <!-- Left Column: Insights -->
            <div class="result-column insights-column">
              <div class="insights-section">
                <div class="insights-header">
                  <span class="insights-icon">💡</span>
                  <h3 class="insights-title">Message Insights</h3>
                </div>
                <ul class="insights-list" id="insightsList"></ul>
                <button class="grade-message-btn">
                  <span class="grade-icon">⭐</span>
                  Grade This Message
                </button>
              </div>
            </div>
            
            <!-- Center Column: Message -->
            <div class="result-column message-column">
              <div class="message-text" id="messageText"></div>
              <div class="button-group">
                <button class="copy-button" onclick="copyMessage()">
                  <span class="button-icon">📋</span>
                  Copy Message
                </button>
                <button class="tweak-button" onclick="showFeedback()">
                  <span class="button-icon">✏️</span>
                  Tweak Message
                </button>
              </div>
              <div class="feedback-section" id="feedbackSection">
                <label for="feedback">How would you like to improve this message?</label>
                <textarea id="feedback" class="feedback-input" placeholder="Example: Make it more formal, add more emotion, be more specific about..."></textarea>
                <button class="tweak-button" onclick="tweakMessage()">Generate New Version</button>
              </div>
            </div>
            
            <!-- Right Column: Controls -->
            <div class="result-column controls-column">
              <div class="message-controls">
                <div class="control-group">
                  <label for="toneAdjustment">Tone Adjustment</label>
                  <div class="slider-container">
                    <input type="range" id="toneAdjustment" min="1" max="5" value="3" class="slider">
                    <div class="slider-labels">
                      <span>More Casual</span>
                      <span>Current</span>
                      <span>More Formal</span>
                    </div>
                  </div>
                </div>
                
                <div class="control-group">
                  <label for="lengthAdjustment">Length Adjustment</label>
                  <div class="slider-container">
                    <input type="range" id="lengthAdjustment" min="1" max="5" value="3" class="slider">
                    <div class="slider-labels">
                      <span>Shorter</span>
                      <span>Current</span>
                      <span>Longer</span>
                    </div>
                  </div>
                </div>
                
                <button class="generate-new-version-btn">
                  <span class="button-icon">🔄</span>
                  Generate New Version
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Learning Screen -->
  <div id="learning-screen" class="screen">
    <div class="dashboard-container">
      <div class="dashboard-header">
        <div class="logo-container">
          <div class="logo-heart"></div>
          <span class="logo-text">HeartGlowAI</span>
        </div>
      </div>
      
      <h1 class="dashboard-title">Perplexity AI Integration</h1>
      <p class="dashboard-subtitle">Test our new AI-powered learning experience</p>
      
      <div class="learning-content" style="text-align: center; padding: 40px 20px;">
        <p style="margin-bottom: 30px; font-size: 18px; color: var(--text-secondary);">
          Click the button below to test our Perplexity AI integration. 
          This will demonstrate our ability to connect with advanced AI models for enhanced learning.
        </p>
        
        <button id="test-perplexity-btn-main" class="primary-button" style="background: linear-gradient(135deg, #6e8efb, #a777e3); margin: 0 auto; padding: 18px 36px; font-size: 18px;">
          <span class="button-content">
            Test Perplexity AI
            <span class="button-icon">🧠</span>
          </span>
        </button>
        
        <div id="perplexity-result" class="learning-answer" style="margin-top: 40px; display: none;">
          <h2>API Test Result</h2>
          <div id="perplexity-response" style="white-space: pre-wrap; text-align: left; font-size: 16px; line-height: 1.6;"></div>
        </div>
      </div>
      
      <div class="dashboard-actions">
        <button id="back-to-home-from-learning" class="dashboard-btn">
          <span class="dashboard-icon">←</span> Back to Home
        </button>
      </div>
    </div>
  </div>
  
  <!-- Add loading overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-container">
      <div class="heart-animation">
        <div class="heart-shape"></div>
        <div class="heart-glow"></div>
        <div class="heart-particles">
          <div class="particle"></div>
          <div class="particle"></div>
          <div class="particle"></div>
          <div class="particle"></div>
          <div class="particle"></div>
        </div>
      </div>
      <div id="loadingContext" class="loading-context">Creating your message...</div>
    </div>
  </div>
  
  <!-- Add Results Popup Overlay -->
  <div id="resultsPopupOverlay" class="results-popup-overlay">
    <div class="results-popup-container">
      <div class="results-popup-header">
        <h2 class="results-popup-title">Your Message</h2>
        <button class="results-popup-close" onclick="hideResultsPopup()">×</button>
      </div>
      
      <div class="popup-result-layout">
        <!-- Left Column: Insights -->
        <div class="popup-result-column popup-insights-column">
          <div class="popup-insights-section">
            <div class="popup-insights-header">
              <span class="popup-insights-icon">💡</span>
              <h3 class="popup-insights-title">Message Insights</h3>
            </div>
            <ul class="popup-insights-list" id="popupInsightsList"></ul>
          </div>
        </div>
        
        <!-- Center Column: Message -->
        <div class="popup-result-column popup-message-column">
          <div class="popup-message-text" id="popupMessageText"></div>
          <div class="popup-button-group">
            <button class="popup-copy-button" onclick="copyPopupMessage()">
              <span class="popup-button-icon">📋</span>
              Copy Message
            </button>
            <button class="popup-tweak-button" onclick="showPopupFeedback()">
              <span class="popup-button-icon">✏️</span>
              Tweak Message
            </button>
          </div>
          <div class="popup-feedback-section" id="popupFeedbackSection">
            <textarea id="popupFeedback" placeholder="How would you like to improve this message? Be specific about what to change."></textarea>
            <button class="popup-tweak-button" onclick="tweakPopupMessage()">Generate New Version</button>
          </div>
        </div>
        
        <!-- Right Column: Controls -->
        <div class="popup-result-column popup-controls-column">
          <div class="popup-controls-section">
            <h3 class="popup-controls-title">Tone Adjustment</h3>
            <div class="popup-slider-container">
              <input type="range" id="popupToneAdjustment" min="1" max="5" value="3" class="popup-slider">
              <div class="popup-slider-labels">
                <span>More Casual</span>
                <span class="popup-slider-current">Current</span>
                <span>More Formal</span>
              </div>
            </div>
            
            <h3 class="popup-controls-title">Length Adjustment</h3>
            <div class="popup-slider-container">
              <input type="range" id="popupLengthAdjustment" min="1" max="5" value="3" class="popup-slider">
              <div class="popup-slider-labels">
                <span>Shorter</span>
                <span class="popup-slider-current">Current</span>
                <span>Longer</span>
              </div>
            </div>
            
            <button class="popup-generate-new-btn" onclick="regenerateWithOptions()">
              <span>🔄</span> Generate New Version
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add Dashboard Screen -->
  <div id="dashboard-screen" class="screen">
    <div class="dashboard-container">
      <div class="dashboard-header">
        <div class="logo-container">
          <div class="logo-heart"></div>
          <span class="logo-text">HeartGlowAI</span>
        </div>
      </div>
      
      <h1 class="dashboard-title">Dashboard</h1>
      <p class="dashboard-subtitle">Track your communication progress and insights</p>
      
      <div class="dashboard-card">
        <div class="dashboard-card-title">
          <span class="icon">📈</span> Message Statistics
        </div>
        <div class="stats-container">
          <div class="stat-item">
            <div class="stat-value" data-stat="messages">...</div>
            <div class="stat-label">Messages Created</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" data-stat="relationships">...</div>
            <div class="stat-label">Relationships</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" data-stat="templates">...</div>
            <div class="stat-label">Templates Used</div>
          </div>
        </div>
        <div class="chart-container">
          <div class="chart-placeholder">Message activity chart will appear here</div>
        </div>
      </div>
      
      <div class="dashboard-card">
        <div class="dashboard-card-title">
          <span class="icon">💬</span> Recent Messages
        </div>
        <div class="message-history">
          <div style="text-align: center; padding: 20px;">Loading messages...</div>
        </div>
      </div>
      
      <div class="dashboard-actions">
        <button id="back-to-home-from-dashboard" class="dashboard-btn">
          <span class="dashboard-icon">←</span> Back to Home
        </button>
      </div>
    </div>
  </div>
  
  <!-- Blueprint Management Screen -->
  <div id="blueprint-screen" class="screen blueprint-dashboard" style="display: none;">
    <div class="dashboard-header">
      <h2>Relationship Blueprints</h2>
      <p>Manage your personalized relationship guides.</p>
      <button id="create-new-blueprint-btn" class="primary-button">Create New Blueprint</button>
    </div>
    <div id="blueprint-list-container" class="blueprint-list-container">
      <!-- Blueprints will be loaded here by JavaScript -->
      <p>Loading blueprints...</p> 
    </div>
    <button id="back-to-home-from-blueprints-btn" class="secondary-button">Back to Home</button>
  </div>
  
  <!-- JavaScript -->
  <script src="js/main.js?v=20250330"></script>
  <script src="js/learn-with-ai.js"></script>
</body>
</html> 