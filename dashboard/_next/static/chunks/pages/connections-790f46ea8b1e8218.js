(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13],{7958:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connections",function(){return n(4758)}])},1798:function(e,t,n){"use strict";n.d(t,{HE:function(){return addConnection},HZ:function(){return updateConnection},Qf:function(){return updateConnectionWithMessage},RU:function(){return getConnectionFrequency},Rd:function(){return deleteConnection},S7:function(){return fetchUserConnections},SY:function(){return formatRelativeTime},db:function(){return r.db},eA:function(){return fetchUserMessages}});var o=n(6100),r=n(4417);let getConnectionFrequency=e=>{if(!e.messageCount||0===e.messageCount)return"new";if(!e.lastMessageDate)return"recent";let t=new Date,n=e.lastMessageDate.toDate(),o=Math.floor((t.getTime()-n.getTime())/864e5);return o<=7?"frequent":o<=30?"recent":"new"},fetchUserConnections=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e)return console.log("No authenticated user found for fetching connections"),[];try{console.log("Fetching connections for user ID: ".concat(e.uid));let n=(0,o.hJ)(r.db,"users/".concat(e.uid,"/connections")),a=(0,o.IO)(n,(0,o.Xo)("updatedAt","desc"),(0,o.b9)(t));console.log("Executing Firestore query for connections");let c=await (0,o.PL)(a);console.log("Retrieved ".concat(c.docs.length," connections from Firestore"));let s=c.docs.map(e=>{let t=e.data();return console.log("Connection found - ID: ".concat(e.id,", Name: ").concat(t.name,", Relationship: ").concat(t.relationship)),{id:e.id,...t}});return s}catch(e){return console.error("Error fetching connections:",e),[]}},fetchUserMessages=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e)return console.log("No authenticated user found for fetching messages"),[];try{console.log("Fetching messages for user ID: ".concat(e.uid));let n=(0,o.hJ)(r.db,"users/".concat(e.uid,"/messages")),a=(0,o.IO)(n,(0,o.Xo)("createdAt","desc"),(0,o.b9)(t));console.log("Executing Firestore query for messages");let c=await (0,o.PL)(a);console.log("Retrieved ".concat(c.docs.length," messages from Firestore"));let s=c.docs.map(e=>{let t=e.data();return console.log("Message found - ID: ".concat(e.id,", Recipient: ").concat(t.recipientName)),{id:e.id,...t}});return s}catch(e){return console.error("Error fetching messages:",e),[]}},addConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{let n=(0,o.hJ)(r.db,"users/".concat(e.uid,"/connections")),a=o.EK.now(),c={...t,createdAt:a,updatedAt:a,messageCount:0},s=await (0,o.ET)(n,c);return{id:s.id,...c}}catch(e){throw console.error("Error adding connection:",e),e}},updateConnectionWithMessage=async(e,t)=>{if(e&&t)try{let n=(0,o.JU)(r.db,"users/".concat(e.uid,"/connections/").concat(t));await (0,o.r7)(n,{messageCount:(0,o.nP)(1),lastMessageDate:(0,o.Bt)(),updatedAt:(0,o.Bt)()}),console.log("Updated connection ".concat(t," with new message info."))}catch(e){console.error("Error updating connection ".concat(t," after message:"),e)}},updateConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{let n=(0,o.JU)(r.db,"users/".concat(e.uid,"/connections/").concat(t.id)),a={...t,updatedAt:o.EK.now()};delete a.id,await (0,o.r7)(n,a);let c=await (0,o.QT)(n);return{id:t.id,...c.data()}}catch(e){throw console.error("Error updating connection:",e),e}},formatRelativeTime=e=>{if(!e)return"Never";let t=new Date,n=e.toDate(),o=t.getTime()-n.getTime(),r=Math.floor(o/864e5),a=Math.floor(o%864e5/36e5),c=Math.floor(o%36e5/6e4);return r>30?"".concat(Math.floor(r/30)," ").concat(1===Math.floor(r/30)?"month":"months"," ago"):r>0?"".concat(r," ").concat(1===r?"day":"days"," ago"):a>0?"".concat(a," ").concat(1===a?"hour":"hours"," ago"):c>0?"".concat(c," ").concat(1===c?"minute":"minutes"," ago"):"Just now"},deleteConnection=async(e,t)=>{if(!e)throw Error("User not authenticated");try{console.log("Deleting connection with ID: ".concat(t," for user: ").concat(e.uid));let n=(0,o.JU)(r.db,"users/".concat(e.uid,"/connections/").concat(t));return await (0,o.oe)(n),console.log("Successfully deleted connection with ID: ".concat(t)),!0}catch(e){throw console.error("Error deleting connection:",e),e}}},4758:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return AllConnectionsPage}});var o=n(5893),r=n(7294),a=n(1664),c=n.n(a),s=n(3495),i=n(8549),l=n(1798),d=n(1810),u=n(9406);let getInitials=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"?",getFrequencyColor=e=>{switch(e){case"frequent":return"bg-purple-500";case"recent":return"bg-blue-500";case"new":return"bg-green-500";default:return"bg-gray-500"}},ConnectionGridCard=e=>{let{connection:t}=e,n=(0,l.RU)(t),r=t.lastMessageDate?(0,l.SY)(t.lastMessageDate):"No messages yet";return(0,o.jsxs)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"bg-white dark:bg-heartglow-deepgray rounded-lg shadow-md border border-gray-100 dark:border-gray-800 p-4 transition-all duration-300 hover:shadow-lg group transform hover:-translate-y-1",children:[(0,o.jsxs)("div",{className:"flex items-center mb-3",children:[(0,o.jsxs)("div",{className:"relative mr-3",children:[(0,o.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-heartglow-pink to-heartglow-violet flex items-center justify-center text-white text-lg font-semibold shadow-sm",children:getInitials(t.name)}),(0,o.jsx)("div",{className:"absolute -right-1 bottom-0 w-3 h-3 rounded-full border-2 border-white dark:border-heartglow-deepgray ".concat(getFrequencyColor(n))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"font-semibold text-heartglow-charcoal dark:text-heartglow-offwhite text-md",children:t.name}),(0,o.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.relationship||"Connection"})]})]}),(0,o.jsxs)("p",{className:"text-xs text-heartglow-pink mb-3",children:["Last message: ",r]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,o.jsx)(c(),{href:"/connections/".concat(t.id),className:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-3 py-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600",children:"View/Edit"}),(0,o.jsx)(c(),{href:"/create?recipientId=".concat(t.id,"&recipientName=").concat(encodeURIComponent(t.name),"&relationship=").concat(encodeURIComponent(t.relationship||"")),className:"text-xs bg-heartglow-pink/10 text-heartglow-pink px-3 py-1 rounded-full hover:bg-heartglow-pink/20",children:"New Message"})]})]})};function AllConnectionsPage(){let{currentUser:e}=(0,i.a)(),[t,n]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),[g,h]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let loadData=async()=>{if(e)try{s(!0);let t=await (0,l.S7)(e,1e3);n(t),h(null)}catch(e){console.error("Error fetching all connections:",e),h("Failed to load connections.")}finally{s(!1)}};loadData()},[e]),(0,o.jsx)(u.Z,{children:(0,o.jsx)(d.Z,{children:(0,o.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-heartglow-charcoal dark:text-heartglow-offwhite",children:"Your Connections"}),(0,o.jsxs)(c(),{href:"/connections/add",className:"inline-flex items-center justify-center bg-gradient-to-r from-heartglow-pink to-heartglow-violet text-white font-medium rounded-full px-5 py-2.5 shadow-md hover:shadow-lg hover:shadow-glow transition-all duration-300",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Connection"]})]}),a&&(0,o.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-heartglow-pink"})}),g&&(0,o.jsx)("div",{className:"text-center py-10 bg-red-50 dark:bg-red-900/20 p-6 rounded-lg",children:(0,o.jsx)("p",{className:"text-red-600 dark:text-red-300",children:g})}),!a&&!g&&0===t.length&&(0,o.jsx)("div",{className:"text-center py-10 bg-gray-50 dark:bg-gray-800/30 p-6 rounded-lg",children:(0,o.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"You haven't added any connections yet."})}),!a&&!g&&t.length>0&&(0,o.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:t.map(e=>(0,o.jsx)(ConnectionGridCard,{connection:e},e.id))})]})})})}}},function(e){e.O(0,[424,495,270,774,888,179],function(){return e(e.s=7958)}),_N_E=e.O()}]);