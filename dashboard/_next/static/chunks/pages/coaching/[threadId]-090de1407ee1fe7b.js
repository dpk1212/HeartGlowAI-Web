(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{1247:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/coaching/[threadId]",function(){return t(9244)}])},8477:function(e,r,t){"use strict";t.d(r,{db:function(){return i},l:function(){return o}});var a=t(3977),s=t(9451),n=t(6100);let o=(0,a.C6)().length?(0,a.C6)()[0]:(0,a.ZF)({apiKey:"AIzaSyBZiJPTs7dMccVgFV-YoTejnhy1bZNFEQY",authDomain:"heartglowai.firebaseapp.com",projectId:"heartglowai",storageBucket:"heartglowai.firebasestorage.app",messagingSenderId:"196565711798",appId:"1:196565711798:web:79e2b0320fd8e74ab0df17",measurementId:"G-KJMPL1DNPY"});(0,s.v0)(o);let i=(0,n.ad)(o)},9244:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return _threadId_}});var a=t(5893),s=t(7294),n=t(9008),o=t.n(n),i=t(1163),d=t(1810),l=t(9406),c=t(2469),h=t(8549),g=t(8477),u=t(6100),m=t(7004);let f=(0,m.$C)();var coaching_CoachingChatView=e=>{var r;let{threadId:t}=e,{currentUser:n}=(0,h.a)(),[o,i]=(0,s.useState)(null),[d,l]=(0,s.useState)([]),[x,p]=(0,s.useState)(!0),[b,y]=(0,s.useState)(!0),[w,v]=(0,s.useState)(null),[j,k]=(0,s.useState)(""),N=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!t)return;p(!0),v(null);let e=(0,u.JU)(g.db,"coachingThreads",t);(0,u.QT)(e).then(e=>{if(e.exists()){let r={id:e.id,...e.data()};r.userId===(null==n?void 0:n.uid)?i(r):(v("You don't have permission to view this chat."),console.error("User mismatch for thread access"))}else v("Chat thread not found.")}).catch(e=>{console.error("Error fetching thread data: ",e),v("Failed to load chat details.")}).finally(()=>{p(!1)})},[t,n]),(0,s.useEffect)(()=>{if(!t)return;y(!0),v(null);let e=(0,u.hJ)(g.db,"coachingThreads",t,"messages"),r=(0,u.IO)(e,(0,u.Xo)("timestamp","asc")),a=(0,u.cf)(r,e=>{let r=e.docs.map(e=>({id:e.id,...e.data()}));l(r),y(!1)},e=>{console.error("Error fetching messages: ",e),v("Failed to load messages."),y(!1)});return()=>a()},[t]),(0,s.useEffect)(()=>{var e;null===(e=N.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[d]);let handleSendMessage=async e=>{if(e.preventDefault(),!j.trim()||!n||!t)return;let r=j.trim();k("");try{let e=(0,u.hJ)(g.db,"coachingThreads",t,"messages"),a=await (0,u.ET)(e,{threadId:t,sender:"user",content:r,timestamp:(0,u.Bt)()});console.log("User message saved with ID: ",a.id),console.log("Calling coachingAssistant function...");let s=(0,m.V1)(f,"coachingAssistant");await s({threadId:t,userMessage:r}),console.log("coachingAssistant function called successfully.")}catch(e){console.error("Error sending message or calling function: ",e)}},formatTimestamp=e=>{if(!e)return"";let r=e instanceof u.EK?e.toDate():e;return r.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0})};return x?(0,a.jsx)("div",{className:"flex justify-center items-center h-full p-6",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-heartglow-pink"})}):w?(0,a.jsxs)("div",{className:"p-6 text-center text-red-600 dark:text-red-400",children:["Error: ",w]}):o?(0,a.jsxs)("div",{className:"flex flex-col h-[calc(100vh-var(--header-height)-var(--footer-height)-2rem)] md:h-[calc(100vh-var(--header-height)-var(--footer-height)-4rem)] bg-white dark:bg-heartglow-deepgray border border-gray-200 dark:border-gray-700 rounded-lg shadow-md overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 sticky top-0 z-10",children:(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 truncate",children:[o.threadTitle,(null===(r=o.connectionSnapshot)||void 0===r?void 0:r.name)&&(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400 ml-2",children:["(Regarding: ",o.connectionSnapshot.name,")"]})]})}),(0,a.jsxs)("div",{className:"flex-grow overflow-y-auto p-4 md:p-6 space-y-4 bg-white dark:bg-heartglow-deepgray scroll-smooth",children:[b?(0,a.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-heartglow-pink"})}):0===d.length?(0,a.jsx)("p",{className:"text-center text-gray-500 dark:text-gray-400 pt-8",children:"Send a message to start the conversation."}):d.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"py-2 px-4 rounded-2xl max-w-sm md:max-w-md lg:max-w-lg shadow-sm ".concat("user"===e.sender?"bg-gradient-to-br from-heartglow-pink to-heartglow-violet text-white rounded-br-none":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-bl-none"),children:[(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),(0,a.jsx)("p",{className:"text-xs mt-1 text-right ".concat("user"===e.sender?"text-pink-100/80":"text-gray-500 dark:text-gray-400"),children:formatTimestamp(e.timestamp)})]})},e.id)),(0,a.jsx)("div",{ref:N})]}),(0,a.jsx)("div",{className:"p-3 md:p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("form",{onSubmit:handleSendMessage,className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"text",placeholder:"Talk to your coach...",value:j,onChange:e=>k(e.target.value),className:"flex-grow bg-white dark:bg-gray-700 text-gray-900 dark:text-heartglow-offwhite border border-gray-300 dark:border-gray-600 rounded-lg p-3 placeholder-gray-400 dark:placeholder-gray-400 focus:ring-2 focus:ring-heartglow-pink focus:border-transparent text-sm","aria-label":"Message input",disabled:x||b}),(0,a.jsx)("button",{type:"submit",disabled:!j.trim()||x||b,"aria-label":"Send message",className:"shrink-0 inline-flex items-center justify-center px-4 h-12 w-12 rounded-full text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-heartglow-pink dark:focus:ring-offset-gray-800 ".concat(!j.trim()||x||b?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-gradient-to-br from-heartglow-pink to-heartglow-violet hover:from-heartglow-violet hover:to-heartglow-indigo shadow-md hover:shadow-lg"),children:(0,a.jsx)(c.kcA,{className:"h-5 w-5"})})]})})]}):(0,a.jsx)("div",{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"Chat not found or access denied."})},_threadId_=()=>{let e=(0,i.useRouter)(),{threadId:r}=e.query;return r&&"string"==typeof r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:"HeartGlow AI | Coaching Chat"}),(0,a.jsx)("meta",{name:"description",content:"AI coaching chat for thread ".concat(r)})]}),(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{children:(0,a.jsx)(coaching_CoachingChatView,{threadId:r})})})]}):(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{children:(0,a.jsx)("div",{className:"p-6 text-center",children:"Loading chat or invalid thread ID..."})})})}}},function(e){e.O(0,[409,424,4,270,774,888,179],function(){return e(e.s=1247)}),_N_E=e.O()}]);